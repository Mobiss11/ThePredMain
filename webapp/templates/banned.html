{% extends "base.html" %}

{% block title %}Account Banned - ThePred{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="glass rounded-2xl p-8 text-center">
        <!-- Icon -->
        <div class="w-24 h-24 bg-red-600 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg class="w-12 h-12 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
            </svg>
        </div>

        <!-- Title -->
        <h1 class="text-3xl font-bold text-red-400 mb-4">üö´ –ê–∫–∫–∞—É–Ω—Ç –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</h1>

        <!-- Message -->
        <p class="text-gray-300 mb-6">
            –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π ThePred.
        </p>

        <!-- Reason -->
        <div class="glass rounded-xl p-6 mb-6 text-left">
            <h3 class="font-bold mb-2 flex items-center">
                <svg class="w-5 h-5 text-yellow-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</span>
            </h3>
            <p class="text-gray-300" id="ban-reason">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>

        <!-- Info -->
        <div class="bg-yellow-400 bg-opacity-10 border border-yellow-400 border-opacity-30 rounded-xl p-4 mb-6 text-left">
            <p class="text-gray-300 text-sm">
                <strong class="text-yellow-400">–ß—Ç–æ –¥–µ–ª–∞—Ç—å?</strong><br>
                –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±—ã–ª–∞ –æ—à–∏–±–æ—á–Ω–æ–π, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∞—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é —á–µ—Ä–µ–∑ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é.
            </p>
        </div>

        <!-- Actions -->
        <div class="space-y-3">
            <button onclick="createAppealTicket()" class="w-full gold-gradient rounded-xl py-3 font-bold text-black hover:opacity-90 transition">
                üì® –ü–æ–¥–∞—Ç—å –ê–ø–µ–ª–ª—è—Ü–∏—é
            </button>
            <a href="/support" class="block w-full glass rounded-xl py-3 font-bold hover:bg-opacity-20 transition">
                üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å –ü–æ–¥–¥–µ—Ä–∂–∫–æ–π
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Load ban reason
document.addEventListener('DOMContentLoaded', async () => {
    console.log('[banned.html] Page loaded');

    // Get user profile to show ban reason
    if (window.userProfile && window.userProfile.ban_reason) {
        document.getElementById('ban-reason').textContent = window.userProfile.ban_reason;
    } else {
        // Try to load profile if not loaded yet
        try {
            const response = await fetch(`${API_URL}/profile`);
            if (response.ok) {
                const profile = await response.json();
                document.getElementById('ban-reason').textContent = profile.ban_reason || '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–µ—Ä–≤–∏—Å–∞';
            } else {
                document.getElementById('ban-reason').textContent = '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–µ—Ä–≤–∏—Å–∞';
            }
        } catch (error) {
            console.error('Failed to load ban reason:', error);
            document.getElementById('ban-reason').textContent = '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–µ—Ä–≤–∏—Å–∞';
        }
    }
});

// Create appeal ticket
async function createAppealTicket() {
    window.tgHaptic?.light();

    const message = prompt('–û–ø–∏—à–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∞–ø–µ–ª–ª—è—Ü–∏–∏:', '');
    if (!message || message.trim() === '') {
        return;
    }

    try {
        const formData = new FormData();
        formData.append('subject', '–ê–ø–µ–ª–ª—è—Ü–∏—è –ø–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∞–∫–∫–∞—É–Ω—Ç–∞');
        formData.append('message', message);
        formData.append('priority', 'high');

        const response = await fetch(`${API_URL}/support/tickets`, {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            window.tgHaptic?.success();
            window.showTgAlert('‚úÖ –ê–ø–µ–ª–ª—è—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');
        } else {
            window.tgHaptic?.error();
            window.showTgAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∞–ø–µ–ª–ª—è—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
        }
    } catch (error) {
        console.error('Error creating appeal:', error);
        window.tgHaptic?.error();
        window.showTgAlert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
}
</script>
{% endblock %}
