{% extends "base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å –°–æ–±—ã—Ç–∏–µ - ThePred{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
        <a href="/" class="text-gray-400 hover:text-white flex items-center space-x-2 mb-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            <span>–ù–∞–∑–∞–¥ –∫ —Ä—ã–Ω–∫–∞–º</span>
        </a>
        <h1 class="text-3xl font-bold mb-2">–°–æ–∑–¥–∞—Ç—å –°–æ–±—ã—Ç–∏–µ</h1>
        <p class="text-gray-400">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —Å–≤–æ—ë —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π. –û–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º–∏.</p>
    </div>

    <!-- Form -->
    <form id="create-event-form" class="glass rounded-2xl p-6 space-y-5">
        <!-- Event Photo -->
        <div>
            <label class="block text-sm font-medium mb-2">–§–æ—Ç–æ –°–æ–±—ã—Ç–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <div class="glass rounded-xl p-4 border-2 border-dashed border-gray-600 text-center cursor-pointer hover:border-yellow-400 transition" onclick="document.getElementById('event-photo').click()">
                <input type="file" id="event-photo" class="hidden" accept="image/*" onchange="previewEventPhoto(event)">
                <div id="photo-preview" class="hidden mb-2">
                    <img id="photo-preview-img" class="w-full h-48 object-cover rounded-lg">
                </div>
                <div id="photo-placeholder">
                    <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <p class="text-gray-400 text-sm">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ</p>
                </div>
            </div>
        </div>

        <!-- Event Question -->
        <div>
            <label class="block text-sm font-medium mb-2">–í–æ–ø—Ä–æ—Å –°–æ–±—ã—Ç–∏—è *</label>
            <input type="text" id="event-question" required
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–æ—Å—Ç–∏–≥–Ω–µ—Ç –ª–∏ Bitcoin $100,000 –∫ –∫–æ–Ω—Ü—É 2025?"
                   class="w-full glass rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-yellow-400">
            <p class="text-gray-500 text-xs mt-1">–§–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–æ–ø—Ä–æ—Å —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∞ –Ω–µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –æ—Ç–≤–µ—Ç–∏—Ç—å "–î–∞" –∏–ª–∏ "–ù–µ—Ç"</p>
        </div>

        <!-- Event Description -->
        <div>
            <label class="block text-sm font-medium mb-2">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
            <textarea id="event-description" required rows="4"
                      placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞..."
                      class="w-full glass rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 resize-none"></textarea>
            <p class="text-gray-500 text-xs mt-1">–û–ø–∏—à–∏—Ç–µ —Å–æ–±—ã—Ç–∏–µ –∏ –∫–∞–∫ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç</p>
        </div>

        <!-- Category -->
        <div>
            <label class="block text-sm font-medium mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
            <select id="event-category" required class="w-full glass rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                <option value="Crypto">üí∞ –ö—Ä–∏–ø—Ç–æ</option>
                <option value="Sports">‚öΩ –°–ø–æ—Ä—Ç</option>
                <option value="Politics">üèõÔ∏è –ü–æ–ª–∏—Ç–∏–∫–∞</option>
                <option value="Entertainment">üé¨ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                <option value="Technology">üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</option>
                <option value="Finance">üìà –§–∏–Ω–∞–Ω—Å—ã</option>
            </select>
        </div>

        <!-- End Date -->
        <div>
            <label class="block text-sm font-medium mb-2">–î–∞—Ç–∞ –û–∫–æ–Ω—á–∞–Ω–∏—è *</label>
            <input type="datetime-local" id="event-end-date" required
                   class="w-full glass rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-yellow-400">
            <p class="text-gray-500 text-xs mt-1">–ö–æ–≥–¥–∞ —Å–æ–±—ã—Ç–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–æ</p>
        </div>

        <!-- Info Box -->
        <div class="glass rounded-xl p-4 bg-yellow-400 bg-opacity-10 border border-yellow-400 border-opacity-30">
            <h3 class="font-bold mb-2 flex items-center space-x-2">
                <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–∞–ª—å—à–µ?</span>
            </h3>
            <ul class="text-sm text-gray-300 space-y-1">
                <li>‚úÖ –í–∞—à–µ —Å–æ–±—ã—Ç–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é</li>
                <li>‚è≥ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –ø—Ä–æ–≤–µ—Ä—è—Ç –µ–≥–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤</li>
                <li>üéØ –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –æ–±—â–µ–º —Å–ø–∏—Å–∫–µ</li>
                <li>üìä –í—ã —Å–º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –ø—Ä–æ—Ñ–∏–ª–µ</li>
            </ul>
        </div>

        <!-- Buttons -->
        <div class="flex gap-3 pt-4">
            <a href="/" class="flex-1">
                <button type="button" class="w-full glass rounded-xl py-3 font-bold hover:bg-opacity-20 transition">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </a>
            <button type="submit" class="flex-1 gold-gradient rounded-xl py-3 font-bold text-black hover:opacity-90 transition">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ú–æ–¥–µ—Ä–∞—Ü–∏—é
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Preview event photo
function previewEventPhoto(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('photo-preview-img').src = e.target.result;
            document.getElementById('photo-preview').classList.remove('hidden');
            document.getElementById('photo-placeholder').style.display = 'none';
        };
        reader.readAsDataURL(file);
    }
}

// Submit create event form
document.addEventListener('DOMContentLoaded', () => {
    const createEventForm = document.getElementById('create-event-form');
    if (createEventForm) {
        createEventForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            window.tgHaptic?.light();

            // Check if user is loaded
            if (!window.userProfile || !window.userProfile.id) {
                window.tgHaptic?.error();
                window.showTgAlert('–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            const formData = new FormData();
            formData.append('user_id', window.userProfile.id);

            const photoFile = document.getElementById('event-photo').files[0];
            if (photoFile) {
                formData.append('photo', photoFile);
            }

            formData.append('title', document.getElementById('event-question').value);
            formData.append('description', document.getElementById('event-description').value);
            formData.append('category', document.getElementById('event-category').value);
            formData.append('resolve_date', document.getElementById('event-end-date').value);

            try {
                const response = await fetch(`${API_URL}/markets/create-event`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    window.tgHaptic?.success();
                    window.showTgAlert('–°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!');
                    // Redirect to markets page
                    window.location.href = '/';
                } else {
                    const error = await response.json();
                    window.tgHaptic?.error();
                    window.showTgAlert(error.error || error.detail || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è');
                }
            } catch (error) {
                console.error('Create event error:', error);
                window.tgHaptic?.error();
                window.showTgAlert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
            }
        });
    }
});
</script>
{% endblock %}
