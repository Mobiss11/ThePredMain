{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å - ThePred{% endblock %}

{% block content %}
<!-- Profile Header -->
<div class="glass card-shine rounded-2xl p-6 mb-6">
    <div class="flex items-center space-x-4 mb-6">
        <div class="w-20 h-20 gold-gradient rounded-2xl flex items-center justify-center text-3xl font-bold pulse-gold">
            üèÜ
        </div>
        <div class="flex-1">
            <h1 class="text-2xl font-bold mb-1" id="username">–ò–≥—Ä–æ–∫ #12345</h1>
            <div class="flex items-center space-x-2">
                <span class="gold-gradient px-3 py-1 rounded-full text-xs font-bold text-black">
                    üíé –ó–û–õ–û–¢–û–ô –†–ê–ù–ì
                </span>
                <span class="text-gray-400 text-sm">#234 –≤ –º–∏—Ä–µ</span>
            </div>
        </div>
    </div>

    <!-- Balance Cards -->
    <div class="grid grid-cols-2 gap-4">
        <div class="glass rounded-xl p-4">
            <div class="text-gray-400 text-sm mb-1">–ë–∞–ª–∞–Ω—Å PRED</div>
            <div class="text-2xl font-bold text-yellow-400" id="pred-balance-display">1,000</div>
            <div class="text-green-400 text-xs mt-1">+250 –∑–∞ –Ω–µ–¥–µ–ª—é</div>
        </div>
        <div class="glass rounded-xl p-4">
            <div class="text-gray-400 text-sm mb-1">–ë–∞–ª–∞–Ω—Å TON</div>
            <div class="text-2xl font-bold text-blue-400" id="ton-balance-display">0.00</div>
            <button class="gold-gradient px-3 py-1 rounded-lg text-xs font-bold text-black mt-2">
                + –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
        </div>
    </div>
</div>

<!-- Stats -->
<div class="glass rounded-2xl p-6 mb-6">
    <h2 class="text-xl font-bold mb-4">üìä –í–∞—à–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <div class="grid grid-cols-2 gap-4">
        <div class="glass rounded-xl p-4 text-center">
            <div class="text-3xl font-bold text-white mb-1">156</div>
            <div class="text-gray-400 text-sm">–í—Å–µ–≥–æ –ü—Ä–æ–≥–Ω–æ–∑–æ–≤</div>
        </div>
        <div class="glass rounded-xl p-4 text-center">
            <div class="text-3xl font-bold text-green-400 mb-1">89</div>
            <div class="text-gray-400 text-sm">–ü–æ–±–µ–¥</div>
        </div>
        <div class="glass rounded-xl p-4 text-center">
            <div class="text-3xl font-bold text-red-400 mb-1">67</div>
            <div class="text-gray-400 text-sm">–ü—Ä–æ–∏–≥—Ä—ã—à–µ–π</div>
        </div>
        <div class="glass rounded-xl p-4 text-center">
            <div class="text-3xl font-bold text-purple-400 mb-1">57%</div>
            <div class="text-gray-400 text-sm">–í–∏–Ω—Ä–µ–π—Ç</div>
        </div>
    </div>

    <div class="mt-4 glass rounded-xl p-4">
        <div class="flex items-center justify-between mb-2">
            <span class="text-gray-400 text-sm">–¢–µ–∫—É—â–∞—è –°–µ—Ä–∏—è</span>
            <span class="text-2xl font-bold text-yellow-400">üî• 7</span>
        </div>
        <div class="flex items-center justify-between">
            <span class="text-gray-400 text-sm">–õ—É—á—à–∞—è –°–µ—Ä–∏—è</span>
            <span class="text-xl font-bold">15</span>
        </div>
    </div>
</div>

<!-- Rank Progress -->
<div class="glass rounded-2xl p-6 mb-6">
    <h2 class="text-xl font-bold mb-4">üéñ –ü—Ä–æ–≥—Ä–µ—Å—Å –†–∞–Ω–≥–∞</h2>

    <div class="space-y-3">
        <div class="glass rounded-xl p-4 opacity-50">
            <div class="flex items-center justify-between mb-2">
                <span class="font-bold">ü•â –ë—Ä–æ–Ω–∑–∞</span>
                <span class="text-sm text-gray-400">0-100 –ø—Ä–æ–≥–Ω–æ–∑–æ–≤</span>
            </div>
            <div class="text-xs text-gray-500">–ö–æ–º–∏—Å—Å–∏—è: 1% PRED, 5% TON</div>
        </div>

        <div class="glass rounded-xl p-4 opacity-50">
            <div class="flex items-center justify-between mb-2">
                <span class="font-bold">ü•à –°–µ—Ä–µ–±—Ä–æ</span>
                <span class="text-sm text-gray-400">100-500 –ø—Ä–æ–≥–Ω–æ–∑–æ–≤</span>
            </div>
            <div class="text-xs text-gray-500">–ö–æ–º–∏—Å—Å–∏—è: 0.8% PRED, 4.5% TON</div>
        </div>

        <div class="glass rounded-xl p-4 border-2 border-yellow-400">
            <div class="flex items-center justify-between mb-2">
                <span class="font-bold text-yellow-400">ü•á –ó–æ–ª–æ—Ç–æ</span>
                <span class="text-sm text-green-400">–¢–ï–ö–£–©–ò–ô</span>
            </div>
            <div class="text-xs text-gray-400 mb-3">–ö–æ–º–∏—Å—Å–∏—è: 0.6% PRED, 4% TON</div>
            <div class="w-full bg-gray-800 rounded-full h-2">
                <div class="gold-gradient h-2 rounded-full" style="width: 31%"></div>
            </div>
            <div class="text-xs text-gray-400 mt-1">156 / 500 –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –¥–æ –ê–ª–º–∞–∑–∞</div>
        </div>

        <div class="glass rounded-xl p-4">
            <div class="flex items-center justify-between mb-2">
                <span class="font-bold">üíé –ê–ª–º–∞–∑</span>
                <span class="text-sm text-gray-400">500-2000 –ø—Ä–æ–≥–Ω–æ–∑–æ–≤</span>
            </div>
            <div class="text-xs text-gray-500">–ö–æ–º–∏—Å—Å–∏—è: 0.4% PRED, 3% TON</div>
        </div>

        <div class="glass rounded-xl p-4">
            <div class="flex items-center justify-between mb-2">
                <span class="font-bold">üåü –õ–µ–≥–µ–Ω–¥–∞</span>
                <span class="text-sm text-gray-400">2000+ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤</span>
            </div>
            <div class="text-xs text-gray-500">–ö–æ–º–∏—Å—Å–∏—è: 0.2% PRED, 2% TON</div>
        </div>
    </div>
</div>

<!-- Referral -->
<div class="glass rounded-2xl p-6 mb-6">
    <h2 class="text-xl font-bold mb-4">üéÅ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –î—Ä—É–∑–µ–π</h2>
    <p class="text-gray-400 text-sm mb-4">–ü–æ–ª—É—á–∞–π—Ç–µ 100 PRED –∑–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞!</p>

    <div class="glass rounded-xl p-4 mb-4">
        <div class="text-gray-400 text-xs mb-2">–í–∞—à–∞ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –°—Å—ã–ª–∫–∞</div>
        <div class="flex items-center space-x-2">
            <input type="text" readonly value="https://t.me/ThePredBot?start=abc123"
                   class="flex-1 bg-transparent text-sm focus:outline-none">
            <button onclick="copyReferralLink()" class="gold-gradient px-4 py-2 rounded-lg font-bold text-black text-sm">
                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
            </button>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4">
        <div class="glass rounded-xl p-4 text-center">
            <div class="text-2xl font-bold mb-1">12</div>
            <div class="text-gray-400 text-xs">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>
        </div>
        <div class="glass rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-yellow-400 mb-1">1,200</div>
            <div class="text-gray-400 text-xs">PRED –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
        </div>
    </div>
</div>

<!-- Recent Bets -->
<div class="glass rounded-2xl p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold">üìú –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ü—Ä–æ–≥–Ω–æ–∑—ã</h2>
        <a href="#" class="text-yellow-400 text-sm">–í—Å–µ</a>
    </div>

    <div class="space-y-3">
        <div class="glass rounded-xl p-4">
            <div class="flex items-start justify-between mb-2">
                <div class="flex-1">
                    <div class="font-medium mb-1">Bitcoin > $100k?</div>
                    <div class="text-xs text-gray-400">–ü—Ä–æ–≥–Ω–æ–∑ –î–ê ‚Ä¢ 1,000 PRED</div>
                </div>
                <span class="green-gradient px-3 py-1 rounded-full text-xs font-bold text-white">
                    –í–´–ò–ì–†–´–®
                </span>
            </div>
            <div class="text-xs text-gray-500">+1,850 PRED ‚Ä¢ 2—á –Ω–∞–∑–∞–¥</div>
        </div>

        <div class="glass rounded-xl p-4">
            <div class="flex items-start justify-between mb-2">
                <div class="flex-1">
                    <div class="font-medium mb-1">Man City wins PL?</div>
                    <div class="text-xs text-gray-400">–ü—Ä–æ–≥–Ω–æ–∑ –ù–ï–¢ ‚Ä¢ 500 PRED</div>
                </div>
                <span class="glass px-3 py-1 rounded-full text-xs font-bold text-yellow-400">
                    –û–ñ–ò–î–ê–ù–ò–ï
                </span>
            </div>
            <div class="text-xs text-gray-500">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: +750 PRED ‚Ä¢ 5—á –Ω–∞–∑–∞–¥</div>
        </div>

        <div class="glass rounded-xl p-4">
            <div class="flex items-start justify-between mb-2">
                <div class="flex-1">
                    <div class="font-medium mb-1">ETH ETF Approved?</div>
                    <div class="text-xs text-gray-400">–ü—Ä–æ–≥–Ω–æ–∑ –î–ê ‚Ä¢ 2,000 PRED</div>
                </div>
                <span class="red-gradient px-3 py-1 rounded-full text-xs font-bold text-white">
                    –ü–†–û–ò–ì–†–´–®
                </span>
            </div>
            <div class="text-xs text-gray-500">-2,000 PRED ‚Ä¢ 1–¥ –Ω–∞–∑–∞–¥</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Load profile data
async function loadProfile() {
    try {
        const response = await fetch('/api/profile');
        if (response.ok) {
            const profile = await response.json();

            // Update username
            document.getElementById('username').innerText = profile.username || `Player #${profile.telegram_id}`;

            // Update balances
            document.getElementById('pred-balance-display').innerText = window.formatNumber(profile.pred_balance);
            document.getElementById('ton-balance-display').innerText = profile.ton_balance;

            // Update stats
            const statsElements = document.querySelectorAll('.glass.rounded-xl.p-4.text-center');
            if (statsElements.length >= 4) {
                statsElements[0].querySelector('.text-3xl').innerText = profile.total_bets;
                statsElements[1].querySelector('.text-3xl').innerText = profile.total_wins;
                statsElements[2].querySelector('.text-3xl').innerText = profile.total_losses;

                const winRate = profile.total_bets > 0
                    ? Math.round((profile.total_wins / profile.total_bets) * 100)
                    : 0;
                statsElements[3].querySelector('.text-3xl').innerText = winRate + '%';
            }

            // Update win streak
            const streakElements = document.querySelectorAll('.text-2xl.font-bold, .text-xl.font-bold');
            if (streakElements.length >= 2) {
                streakElements[0].innerHTML = `üî• ${profile.win_streak}`;
            }

            // Update rank
            const rankBadge = document.querySelector('.gold-gradient.px-3.py-1.rounded-full');
            const rankIcons = {
                'Bronze': 'ü•â',
                'Silver': 'ü•à',
                'Gold': 'ü•á',
                'Diamond': 'üíé',
                'Legend': 'üåü'
            };
            const rankNames = {
                'Bronze': '–ë–†–û–ù–ó–û–í–´–ô',
                'Silver': '–°–ï–†–ï–ë–†–Ø–ù–´–ô',
                'Gold': '–ó–û–õ–û–¢–û–ô',
                'Diamond': '–ê–õ–ú–ê–ó–ù–´–ô',
                'Legend': '–õ–ï–ì–ï–ù–î–ê–†–ù–´–ô'
            };
            if (rankBadge) {
                rankBadge.innerHTML = `${rankIcons[profile.rank] || 'üèÜ'} ${rankNames[profile.rank] || profile.rank.toUpperCase()} –†–ê–ù–ì`;
            }

            // Update referral link
            const referralInput = document.querySelector('input[readonly]');
            if (referralInput && profile.referral_code) {
                referralInput.value = `https://t.me/ThePredBot?start=${profile.referral_code}`;
            }
        }
    } catch (error) {
        console.error('Failed to load profile:', error);
    }
}

// Load bet history
async function loadBetHistory() {
    try {
        const response = await fetch('/api/bets/history');
        if (response.ok) {
            const bets = await response.json();

            if (bets.length > 0) {
                const recentBetsContainer = document.querySelector('.space-y-3');

                const statusColors = {
                    'WON': 'green-gradient',
                    'LOST': 'red-gradient',
                    'PENDING': 'glass'
                };

                const statusTextColors = {
                    'WON': 'text-white',
                    'LOST': 'text-white',
                    'PENDING': 'text-yellow-400'
                };

                const statusTranslations = {
                    'WON': '–í–´–ò–ì–†–´–®',
                    'LOST': '–ü–†–û–ò–ì–†–´–®',
                    'PENDING': '–û–ñ–ò–î–ê–ù–ò–ï'
                };

                recentBetsContainer.innerHTML = bets.slice(0, 5).map(bet => {
                    const statusClass = statusColors[bet.status] || 'glass';
                    const statusTextClass = statusTextColors[bet.status] || 'text-white';
                    const positionText = bet.position === 'YES' ? '–î–ê' : '–ù–ï–¢';

                    return `
                        <div class="glass rounded-xl p-4">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <div class="font-medium mb-1">${bet.market_title || '–†—ã–Ω–æ–∫ #' + bet.market_id}</div>
                                    <div class="text-xs text-gray-400">–ü—Ä–æ–≥–Ω–æ–∑ ${positionText} ‚Ä¢ ${bet.amount} ${bet.currency}</div>
                                </div>
                                <span class="${statusClass} px-3 py-1 rounded-full text-xs font-bold ${statusTextClass}">
                                    ${statusTranslations[bet.status] || bet.status}
                                </span>
                            </div>
                            <div class="text-xs text-gray-500">
                                ${bet.status === 'WON' ? `+${bet.payout} ${bet.currency}` : bet.status === 'LOST' ? `-${bet.amount} ${bet.currency}` : `–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: +${bet.potential_win} ${bet.currency}`}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }
    } catch (error) {
        console.error('Failed to load bet history:', error);
    }
}

function copyReferralLink() {
    const input = document.querySelector('input[readonly]');
    window.copyToClipboard(input.value);
}

// Load data on page load
document.addEventListener('DOMContentLoaded', () => {
    loadProfile();
    loadBetHistory();
});
</script>
{% endblock %}
