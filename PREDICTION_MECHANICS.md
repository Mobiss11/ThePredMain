# ThePred - –ú–µ—Ö–∞–Ω–∏–∫–∞ –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞**: 31 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 1.0

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä—ã–Ω–∫–∏](#–∫–∞–∫-—Ä–∞–±–æ—Ç–∞—é—Ç-—Ä—ã–Ω–∫–∏)
2. [–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å—Ç–∞–≤–∫–∏)
3. [–†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (Odds)](#—Ä–∞—Å—á–µ—Ç-–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤-odds)
4. [–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞](#—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ-—Ä—ã–Ω–∫–∞)
5. [–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—ã–∏–≥—Ä—ã—à–µ–π](#—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ-–≤—ã–∏–≥—Ä—ã—à–µ–π)
6. [–°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤](#—Å–∏—Å—Ç–µ–º–∞-—Ä–∞–Ω–≥–æ–≤)
7. [–ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤](#–ø—Ä–∏–º–µ—Ä—ã-—Ä–∞—Å—á–µ—Ç–æ–≤)

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä—ã–Ω–∫–∏

### –¢–∏–ø—ã —Ä—ã–Ω–∫–æ–≤

ThePred –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–±–∏–Ω–∞—Ä–Ω—ã–µ prediction markets** - —Ä—ã–Ω–∫–∏ —Å –¥–≤—É–º—è –∏—Å—Ö–æ–¥–∞–º–∏:
- **YES** (–î–∞) - —Å–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç
- **NO** (–ù–µ—Ç) - —Å–æ–±—ã—Ç–∏–µ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç

### –°—Ç–∞—Ç—É—Å—ã —Ä—ã–Ω–∫–∞

```python
class MarketStatus:
    OPEN = "open"           # –û—Ç–∫—Ä—ã—Ç - –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏
    RESOLVED = "resolved"   # –ó–∞–∫—Ä—ã—Ç - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–≤–µ—Å—Ç–µ–Ω
    CANCELLED = "cancelled" # –û—Ç–º–µ–Ω–µ–Ω - —Å—Ç–∞–≤–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä—ã–Ω–∫–∞

–ö–∞–∂–¥—ã–π —Ä—ã–Ω–æ–∫ –∏–º–µ–µ—Ç:
- **Title** - –ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Bitcoin > $100k –¥–æ –∫–æ–Ω—Ü–∞ 2025?")
- **Category** - –ö–∞—Ç–µ–≥–æ—Ä–∏—è (Crypto, Sports, Politics, Tech)
- **YES Pool** - –°—É–º–º–∞ –≤—Å–µ—Ö —Å—Ç–∞–≤–æ–∫ –Ω–∞ YES
- **NO Pool** - –°—É–º–º–∞ –≤—Å–µ—Ö —Å—Ç–∞–≤–æ–∫ –Ω–∞ NO
- **YES Odds** - –ü—Ä–æ—Ü–µ–Ω—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ YES
- **NO Odds** - –ü—Ä–æ—Ü–µ–Ω—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ NO
- **Resolve Date** - –î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Ä—ã–Ω–∫–∞

**–í–∞–ª—é—Ç—ã —Å—Ç–∞–≤–æ–∫**:
- **PRED** - –æ—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞ (—Ç–æ–∫–µ–Ω—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
- **TON** - TON cryptocurrency (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

---

## –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏

### –®–∞–≥ 1: –í—ã–±–æ—Ä –ø–æ–∑–∏—Ü–∏–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç:
1. **–ü–æ–∑–∏—Ü–∏—é**: YES –∏–ª–∏ NO
2. **–°—É–º–º—É**: –°–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ—Å—Ç–∞–≤–∏—Ç—å
3. **–í–∞–ª—é—Ç—É**: PRED –∏–ª–∏ TON

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∏

```python
# 1. –†—ã–Ω–æ–∫ –æ—Ç–∫—Ä—ã—Ç?
if market.status != MarketStatus.OPEN:
    raise "Market is not open"

# 2. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞?
if user.pred_balance < bet_amount:
    raise "Insufficient balance"

# 3. –†—ã–Ω–æ–∫ –Ω–µ –∏—Å—Ç–µ–∫?
if market.resolve_date < now():
    raise "Market expired"
```

### –®–∞–≥ 3: –†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤

–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã (odds) —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–∞ –ø—É–ª–æ–≤:

```python
def calculate_odds(yes_pool, no_pool, position, amount):
    total_pool = yes_pool + no_pool + amount

    if position == "YES":
        new_yes_pool = yes_pool + amount
        yes_percentage = (new_yes_pool / total_pool) * 100
        return yes_percentage
    else:
        new_no_pool = no_pool + amount
        no_percentage = (new_no_pool / total_pool) * 100
        return no_percentage
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?**
- Odds = % –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏—è
- –ß–µ–º –±–æ–ª—å—à–µ —Å—Ç–∞–≤–æ–∫ –Ω–∞ YES ‚Üí —Ç–µ–º –≤—ã—à–µ YES odds
- –ß–µ–º –±–æ–ª—å—à–µ —Å—Ç–∞–≤–æ–∫ –Ω–∞ NO ‚Üí —Ç–µ–º –≤—ã—à–µ NO odds
- YES odds + NO odds ‚âà 100%

### –®–∞–≥ 4: –†–∞—Å—á–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –≤—ã–∏–≥—Ä—ã—à–∞

```python
def calculate_potential_win(bet_amount, position, yes_pool, no_pool, commission):
    # –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π –ø—É–ª
    opposite_pool = no_pool if position == "YES" else yes_pool
    my_pool = yes_pool if position == "YES" else no_pool

    if opposite_pool > 0:
        # –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–æ–ª—è –∏–∑ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ –ø—É–ª–∞
        potential_win = bet_amount + (bet_amount * opposite_pool / my_pool)
    else:
        # –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ - —É–¥–≤–æ–µ–Ω–∏–µ
        potential_win = bet_amount * 2

    # –í—ã—á–µ—Å—Ç—å –∫–æ–º–∏—Å—Å–∏—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    potential_win = potential_win * (1 - commission)

    return potential_win
```

**–ö–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**:
- PRED: 0% (–ø–æ–∫–∞ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏)
- TON: 0% (–ø–æ–∫–∞ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –í `settings.py` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:
```python
COMMISSION_PRED = 0.02  # 2%
COMMISSION_TON = 0.03   # 3%
```

### –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞–≤–∫–∏:

```python
# 1. –°–ø–∏—Å–∞—Ç—å –±–∞–ª–∞–Ω—Å
user.pred_balance -= bet_amount

# 2. –î–æ–±–∞–≤–∏—Ç—å –≤ –ø—É–ª —Ä—ã–Ω–∫–∞
if position == "YES":
    market.yes_pool_pred += bet_amount
else:
    market.no_pool_pred += bet_amount

# 3. –û–±–Ω–æ–≤–∏—Ç—å odds —Ä—ã–Ω–∫–∞
total = market.yes_pool_pred + market.no_pool_pred
market.yes_odds = (market.yes_pool_pred / total) * 100
market.no_odds = (market.no_pool_pred / total) * 100

# 4. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
market.bets_count += 1
market.total_volume_pred += bet_amount
user.total_bets += 1

# 5. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å —Å—Ç–∞–≤–∫–∏
bet = Bet(
    user_id=user_id,
    market_id=market_id,
    position=position,
    amount=bet_amount,
    odds=calculated_odds,
    potential_win=potential_win,
    status=BetStatus.PENDING  # –û–∂–∏–¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
)
```

---

## –†–∞—Å—á–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (Odds)

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

ThePred –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **pool-based odds system** (—Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—É–ª–æ–≤), –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ parimutuel betting.

### –§–æ—Ä–º—É–ª–∞

```
YES Odds = (YES Pool / Total Pool) √ó 100%
NO Odds = (NO Pool / Total Pool) √ó 100%

Total Pool = YES Pool + NO Pool
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ

Odds –º–µ–Ω—è—é—Ç—Å—è **—Å –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π —Å—Ç–∞–≤–∫–æ–π**:

**–ü—Ä–∏–º–µ—Ä**:

```
–ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
YES Pool: 0 PRED
NO Pool: 0 PRED
YES Odds: 50%
NO Odds: 50%

–ü–æ—Å–ª–µ 1-–π —Å—Ç–∞–≤–∫–∏ (100 PRED –Ω–∞ YES):
YES Pool: 100 PRED
NO Pool: 0 PRED
YES Odds: 100%
NO Odds: 0%

–ü–æ—Å–ª–µ 2-–π —Å—Ç–∞–≤–∫–∏ (50 PRED –Ω–∞ NO):
YES Pool: 100 PRED
NO Pool: 50 PRED
Total: 150 PRED
YES Odds: 66.7%
NO Odds: 33.3%

–ü–æ—Å–ª–µ 3-–π —Å—Ç–∞–≤–∫–∏ (150 PRED –Ω–∞ NO):
YES Pool: 100 PRED
NO Pool: 200 PRED
Total: 300 PRED
YES Odds: 33.3%
NO Odds: 66.7%
```

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è Odds

- **65% YES odds** = "–†—ã–Ω–æ–∫ —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 65%"
- **35% NO odds** = "–†—ã–Ω–æ–∫ —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 35%"

**–í–∞–∂–Ω–æ**: –≠—Ç–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—è, –∞ **–∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–µ –º–Ω–µ–Ω–∏–µ** —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ä—ã–Ω–∫–∞.

---

## –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞

### –ö—Ç–æ –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å —Ä—ã–Ω–æ–∫?

–¢–æ–ª—å–∫–æ **–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã** —á–µ—Ä–µ–∑ Admin Panel.

### –í–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ö–æ–¥—ã

1. **YES** - –°–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ
2. **NO** - –°–æ–±—ã—Ç–∏–µ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ
3. **CANCELLED** - –†—ã–Ω–æ–∫ –æ—Ç–º–µ–Ω–µ–Ω (–≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤)

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

```python
@router.put("/admin/markets/{market_id}/resolve")
async def resolve_market(market_id, outcome):
    """
    –®–∞–≥–∏:
    1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä—ã–Ω–∫–∞ –Ω–∞ RESOLVED
    2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å outcome (YES/NO/CANCELLED)
    3. –ù–∞–π—Ç–∏ –≤—Å–µ PENDING —Å—Ç–∞–≤–∫–∏
    4. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—ã
    5. –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    6. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (wins/losses/streaks)
    7. –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–Ω–≥–∏
    """

    market.status = MarketStatus.RESOLVED
    market.outcome = outcome
    market.resolved_at = now()

    # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ —Å—Ç–∞–≤–∫–∏
    for bet in pending_bets:
        process_bet(bet, outcome)
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–æ–∫

#### –°–ª—É—á–∞–π 1: CANCELLED (–æ—Ç–º–µ–Ω–∞)

```python
if outcome == "CANCELLED":
    # –í–µ—Ä–Ω—É—Ç—å –≤—Å–µ —Å—Ç–∞–≤–∫–∏
    for bet in bets:
        bet.status = BetStatus.REFUNDED
        bet.payout = bet.amount
        user.pred_balance += bet.amount
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
- –°–æ–±—ã—Ç–∏–µ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏—á–∏–Ω
- –ù–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ –≤–æ–ø—Ä–æ—Å–∞

#### –°–ª—É—á–∞–π 2: YES –∏–ª–∏ NO (–µ—Å—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏)

```python
winning_position = outcome  # "YES" or "NO"

for bet in bets:
    if bet.position == winning_position:
        # –ü–û–ë–ï–î–ò–¢–ï–õ–¨
        process_winner(bet)
    else:
        # –ü–†–û–ò–ì–†–ê–í–®–ò–ô
        process_loser(bet)
```

---

## –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—ã–∏–≥—Ä—ã—à–µ–π

### –§–æ—Ä–º—É–ª–∞ –≤—ã–ø–ª–∞—Ç—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º

```python
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è:
payout = bet_amount + share_of_losing_pool

# –î–æ–ª—è –∏–∑ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ –ø—É–ª–∞:
share_of_losing_pool = (bet_amount / winning_pool) * losing_pool
```

### –ü–æ—à–∞–≥–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç

**–î–∞–Ω–æ**:
- YES Pool: 1000 PRED
- NO Pool: 500 PRED
- Outcome: YES

**–†–∞—Å—á–µ—Ç**:
```python
winning_pool = 1000 PRED  # YES Pool
losing_pool = 500 PRED    # NO Pool

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –ø–æ—Å—Ç–∞–≤–∏–ª 100 PRED –Ω–∞ YES
bet_amount = 100 PRED

# –ï–≥–æ –¥–æ–ª—è –≤ –≤—ã–∏–≥—Ä–∞–≤—à–µ–º –ø—É–ª–µ:
share = 100 / 1000 = 10%

# –ï–≥–æ —á–∞—Å—Ç—å –∏–∑ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ –ø—É–ª–∞:
share_of_losing_pool = 10% * 500 = 50 PRED

# –ò—Ç–æ–≥–æ–≤–∞—è –≤—ã–ø–ª–∞—Ç–∞:
payout = 100 + 50 = 150 PRED

# –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:
profit = 150 - 100 = 50 PRED (+50%)
```

### –ö–æ–¥ –≤—ã–ø–ª–∞—Ç—ã

```python
if bet.position == winning_position:
    # –ü–û–ë–ï–î–ò–¢–ï–õ–¨
    bet.status = BetStatus.WON

    # –†–∞—Å—á–µ—Ç –≤—ã–ø–ª–∞—Ç—ã
    if winning_pool > 0:
        share_of_losing_pool = (bet.amount / winning_pool) * losing_pool
        bet.payout = bet.amount + share_of_losing_pool
    else:
        bet.payout = bet.amount  # –í–æ–∑–≤—Ä–∞—Ç –µ—Å–ª–∏ –Ω–µ—Ç –≤—ã–∏–≥—Ä–∞–≤—à–µ–≥–æ –ø—É–ª–∞

    # –ù–∞—á–∏—Å–ª–∏—Ç—å –≤—ã–∏–≥—Ä—ã—à
    user.pred_balance += bet.payout

    # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    user.total_wins += 1
    user.win_streak += 1

else:
    # –ü–†–û–ò–ì–†–ê–í–®–ò–ô
    bet.status = BetStatus.LOST
    bet.payout = 0

    # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    user.total_losses += 1
    user.win_streak = 0  # –°–±—Ä–æ—Å —Å–µ—Ä–∏–∏
```

### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ —Ç–µ—Ä—è—é—Ç –≤—Å—é —Å—Ç–∞–≤–∫—É** - –∏—Ö —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏–¥—É—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º
2. **–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** - —á–µ–º –±–æ–ª—å—à–µ –ø–æ—Å—Ç–∞–≤–∏–ª, —Ç–µ–º –±–æ–ª—å—à–µ –≤—ã–∏–≥—Ä—ã—à
3. **–†–∞–Ω–Ω–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –≤—ã–≥–æ–¥–Ω–µ–µ** - –µ—Å–ª–∏ —Å—Ç–∞–≤–∏—Ç—å —Ä–∞–Ω–æ, –∫–æ–≥–¥–∞ odds –Ω–∏–∑–∫–∏–µ
4. **–ö–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã** –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –≤—ã–ø–ª–∞—Ç (–ø–æ–∫–∞ 0%)

---

## –°–∏—Å—Ç–µ–º–∞ —Ä–∞–Ω–≥–æ–≤

### –†–∞–Ω–≥–∏ –ø–æ win streak

```python
if win_streak >= 50:
    rank = "Grandmaster"  # üèÜ –ì—Ä–æ—Å—Å–º–µ–π—Å—Ç–µ—Ä
elif win_streak >= 30:
    rank = "Master"       # üíé –ú–∞—Å—Ç–µ—Ä
elif win_streak >= 20:
    rank = "Diamond"      # üí† –ê–ª–º–∞–∑
elif win_streak >= 10:
    rank = "Platinum"     # ‚≠ê –ü–ª–∞—Ç–∏–Ω–∞
elif win_streak >= 5:
    rank = "Gold"         # ü•á –ó–æ–ª–æ—Ç–æ
elif win_streak >= 3:
    rank = "Silver"       # ü•à –°–µ—Ä–µ–±—Ä–æ
else:
    rank = "Bronze"       # ü•â –ë—Ä–æ–Ω–∑–∞
```

### –ü–æ–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–Ω–≥–∞

```python
# –ü—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è win_streak
user.win_streak = 0

# –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π:
if user.total_losses > user.total_wins * 2:
    user.rank = "Bronze"
```

### –ë–æ–Ω—É—Å—ã —Ä–∞–Ω–≥–æ–≤ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)

- **Grandmaster**: +50% –∫ –≤—ã–ø–ª–∞—Ç–∞–º
- **Diamond**: +30% –∫ –≤—ã–ø–ª–∞—Ç–∞–º
- **Gold**: +20% –∫ –≤—ã–ø–ª–∞—Ç–∞–º
- **Silver**: +10% –∫ –≤—ã–ø–ª–∞—Ç–∞–º
- **Bronze**: –ë–µ–∑ –±–æ–Ω—É—Å–æ–≤

---

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∞–≤–∫–∞

**–°–∏—Ç—É–∞—Ü–∏—è**:
```
–†—ã–Ω–æ–∫: "Bitcoin > $100k –¥–æ –∫–æ–Ω—Ü–∞ 2025?"
YES Pool: 0 PRED
NO Pool: 0 PRED
```

**–°—Ç–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A**:
```
Position: YES
Amount: 100 PRED
```

**–†–∞—Å—á–µ—Ç**:
```python
# Odds –ø–æ—Å–ª–µ —Å—Ç–∞–≤–∫–∏
total = 0 + 0 + 100 = 100
YES odds = 100 / 100 = 100%
NO odds = 0 / 100 = 0%

# –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à
opposite_pool = 0  # NO Pool
if opposite_pool > 0:
    potential_win = 100 + (100 * 0 / 100) = 100
else:
    potential_win = 100 * 2 = 200  # –£–¥–≤–æ–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤

# –°—Ç–∞—Ç—É—Å —Å—Ç–∞–≤–∫–∏
bet.status = PENDING
bet.odds = 100%
bet.potential_win = 200 PRED
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –µ—Å–ª–∏ YES**:
```
payout = 200 PRED (–µ—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ—Å—Ç–∞–≤–∏–ª –Ω–∞ NO)
profit = +100 PRED (+100%)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –µ—Å–ª–∏ NO**:
```
payout = 0 PRED
profit = -100 PRED (-100%)
```

---

### –ü—Ä–∏–º–µ—Ä 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**–ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
```
YES Pool: 1000 PRED (10 —á–µ–ª–æ–≤–µ–∫ –ø–æ 100)
NO Pool: 500 PRED (5 —á–µ–ª–æ–≤–µ–∫ –ø–æ 100)
Total: 1500 PRED

YES odds: 66.7%
NO odds: 33.3%
```

**–ù–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B**:
```
Position: NO
Amount: 500 PRED
```

**–ü–æ—Å–ª–µ —Å—Ç–∞–≤–∫–∏**:
```
YES Pool: 1000 PRED
NO Pool: 1000 PRED (500 + 500)
Total: 2000 PRED

YES odds: 50%
NO odds: 50%
```

**–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞**: Outcome = NO

**–†–∞—Å—á–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B**:
```python
# B –ø–æ—Å—Ç–∞–≤–∏–ª 500 –Ω–∞ NO
winning_pool = 1000 PRED (NO Pool)
losing_pool = 1000 PRED (YES Pool)

# –î–æ–ª—è B –≤ –≤—ã–∏–≥—Ä–∞–≤—à–µ–º –ø—É–ª–µ
share = 500 / 1000 = 50%

# –î–æ–ª—è –∏–∑ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ –ø—É–ª–∞
share_of_losing = 50% * 1000 = 500 PRED

# –ò—Ç–æ–≥–æ–≤–∞—è –≤—ã–ø–ª–∞—Ç–∞
payout = 500 + 500 = 1000 PRED

# –ü—Ä–∏–±—ã–ª—å
profit = 1000 - 500 = +500 PRED (+100%)
```

**–†–∞—Å—á–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A** (–æ–¥–∏–Ω –∏–∑ 10, –∫—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª –Ω–∞ YES):
```python
# A –ø–æ—Å—Ç–∞–≤–∏–ª 100 –Ω–∞ YES (–ø—Ä–æ–∏–≥—Ä–∞–ª)
bet.status = LOST
bet.payout = 0
profit = -100 PRED (-100%)
```

**–ò—Ç–æ–≥–æ**:
- **–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ (NO)**: –ó–∞–±—Ä–∞–ª–∏ –≤–µ—Å—å YES Pool (1000) –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- **–ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–µ (YES)**: –ü–æ—Ç–µ—Ä—è–ª–∏ –≤—Å—ë (1000 PRED)
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞**: 0 PRED –∫–æ–º–∏—Å—Å–∏–∏ (–ø–æ–∫–∞)

---

### –ü—Ä–∏–º–µ—Ä 3: –†–∞–Ω–Ω—è—è vs –ø–æ–∑–¥–Ω—è—è —Å—Ç–∞–≤–∫–∞

**–°—Ü–µ–Ω–∞—Ä–∏–π**: Bitcoin > $100k?

**–°—Ç–∞–≤–∫–∞ 1 (—Ä–∞–Ω–æ)**:
```
–í—Ä–µ–º—è: –î–µ–Ω—å 1
YES Pool: 100 PRED
NO Pool: 0 PRED
YES odds: 100%

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A —Å—Ç–∞–≤–∏—Ç 100 –Ω–∞ NO
–ü–æ—Å–ª–µ: YES 100 / NO 100
YES odds: 50% / NO odds: 50%
```

**–°—Ç–∞–≤–∫–∞ 2 (–ø–æ–∑–¥–Ω–æ)**:
```
–í—Ä–µ–º—è: –î–µ–Ω—å 30
YES Pool: 5000 PRED
NO Pool: 1000 PRED
YES odds: 83.3% / NO odds: 16.7%

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B —Å—Ç–∞–≤–∏—Ç 100 –Ω–∞ NO
–ü–æ—Å–ª–µ: YES 5000 / NO 1100
YES odds: 82% / NO odds: 18%
```

**–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ**: Outcome = NO

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A** (—Ä–∞–Ω–Ω—è—è —Å—Ç–∞–≤–∫–∞):
```
bet_amount = 100
winning_pool = 1100 (NO Pool)
losing_pool = 5000 (YES Pool)

share = 100 / 1100 = 9.09%
share_of_losing = 9.09% * 5000 = 454.5 PRED

payout = 100 + 454.5 = 554.5 PRED
profit = +354.5 PRED (+354%!)
```

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B** (–ø–æ–∑–¥–Ω—è—è —Å—Ç–∞–≤–∫–∞):
```
bet_amount = 100
share = 100 / 1100 = 9.09%
share_of_losing = 9.09% * 5000 = 454.5 PRED

payout = 100 + 454.5 = 554.5 PRED
profit = +354.5 PRED (+354%)
```

**–í—ã–≤–æ–¥**: –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞–Ω–Ω–∏–µ –∏ –ø–æ–∑–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –ø–æ–ª—É—á–∞—é—Ç **–æ–¥–∏–Ω–∞–∫–æ–≤—É—é** –≤—ã–ø–ª–∞—Ç—É –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏—Ö –≤–∫–ª–∞–¥—É.

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã

### 1. –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
- –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –≤–∏–¥–Ω—ã –∑–∞—Ä–∞–Ω–µ–µ
- Potential win –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–æ —Å—Ç–∞–≤–∫–∏
- Odds –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### 2. –ß–µ—Å—Ç–Ω–æ—Å—Ç—å
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- –í—ã–ø–ª–∞—Ç—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –í—Å–µ –∑–∞–ø–∏—Å–∏ –≤ blockchain (–≤ –±—É–¥—É—â–µ–º)

### 3. –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
- –ú–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- Odds –º–µ–Ω—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
- –ù–µ—Ç "–∑–∞–∫—Ä—ã—Ç–∏—è" —Å—Ç–∞–≤–æ–∫ –¥–æ resolve date

### 4. –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è
- Win streak ‚Üí –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–∞–Ω–≥–∞
- Leaderboard ‚Üí —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ
- Missions ‚Üí –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã

---

## –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã

### 1. –ù–µ—Ç early exit
- –ù–µ–ª—å–∑—è –≤—ã–π—Ç–∏ –∏–∑ —Å—Ç–∞–≤–∫–∏ –¥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- –ù–µ–ª—å–∑—è "–ø—Ä–æ–¥–∞—Ç—å" —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ** (–±—É–¥—É—â–µ–µ):
```python
# –í—Ç–æ—Ä–∏—á–Ω—ã–π —Ä—ã–Ω–æ–∫
sell_bet(bet_id, price)
buy_bet(bet_id, price)
```

### 2. –ù–µ—Ç —á–∞—Å—Ç–∏—á–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤
- –¢–æ–ª—å–∫–æ YES/NO/CANCELLED
- –ù–µ—Ç "—á–∞—Å—Ç–∏—á–Ω–æ–π –ø–æ–±–µ–¥—ã"

**–†–µ—à–µ–Ω–∏–µ** (–±—É–¥—É—â–µ–µ):
```python
# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å—Ö–æ–¥—ã
outcome = "YES_75%"  # –°–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –Ω–∞ 75%
```

### 3. –ö–æ–º–∏—Å—Å–∏—è –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –ü–æ–∫–∞ COMMISSION = 0%
- –ù–µ—Ç –¥–æ—Ö–æ–¥–∞ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

**–†–µ—à–µ–Ω–∏–µ**:
```python
# –í–∫–ª—é—á–∏—Ç—å –∫–æ–º–∏—Å—Å–∏—é
COMMISSION_PRED = 0.02  # 2%
COMMISSION_TON = 0.03   # 3%
```

---

## API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏

```http
POST /bets/?user_id={user_id}

Body:
{
  "market_id": 1,
  "position": "yes",
  "amount": 100.00,
  "currency": "PRED"
}

Response:
{
  "id": 123,
  "market_id": 1,
  "position": "yes",
  "amount": 100.00,
  "odds": 66.7,
  "potential_win": 150.00,
  "status": "pending"
}
```

### –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞ (Admin)

```http
PUT /admin/markets/{market_id}/resolve

Body:
{
  "outcome": "YES"  // YES, NO, or CANCELLED
}

Response:
{
  "market_id": 1,
  "outcome": "YES",
  "bets_processed": 45,
  "message": "Market resolved with outcome: YES"
}
```

### –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫

```http
GET /bets/history/{user_id}?limit=20

Response:
[
  {
    "id": 123,
    "market_id": 1,
    "position": "yes",
    "amount": 100.00,
    "odds": 66.7,
    "payout": 150.00,
    "status": "won",
    "created_at": "2025-10-31T10:00:00Z"
  }
]
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

ThePred –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **pool-based prediction market** –º–µ—Ö–∞–Ω–∏–∫—É:

1. **–°—Ç–∞–≤–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –ø—É–ª—ã** (YES Pool –∏ NO Pool)
2. **Odds —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–∞ –ø—É–ª–æ–≤
3. **–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –¥–µ–ª—è—Ç –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π –ø—É–ª** –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–≤–æ–∏–º —Å—Ç–∞–≤–∫–∞–º
4. **–†–∞–Ω–Ω—è—è —Å—Ç–∞–≤–∫–∞ = –±–æ–ª—å—à–∏–π —Ä–∏—Å–∫** (–º–µ–Ω—å—à–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏) –Ω–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ **–±–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª–∏**
5. **Win streak** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–Ω–≥ –∏ –±–æ–Ω—É—Å—ã

**–ö–æ–¥**: `backend/app/api/endpoints/`
- `bets.py` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–æ–∫
- `admin.py` - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä—ã–Ω–∫–æ–≤
- `markets.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞–º–∏

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!
