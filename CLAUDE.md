# ThePred - –ü–æ–ª–Ω–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ü—Ä–æ–µ–∫—Ç–∞

**–í–µ—Ä—Å–∏—è**: 1.2
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 8 –Ω–æ—è–±—Ä—è 2025
**–ü—Ä–æ–≥—Ä–µ—Å—Å**: 97% Complete üéâ

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û –ø—Ä–æ–µ–∫—Ç–µ](#–æ-–ø—Ä–æ–µ–∫—Ç–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
5. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
6. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
7. [API Endpoints](#api-endpoints)
8. [–°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#—Å–∏—Å—Ç–µ–º–∞-–æ—á–µ—Ä–µ–¥–µ–π-–∏-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
9. [Broadcast —Å–∏—Å—Ç–µ–º–∞](#broadcast-—Å–∏—Å—Ç–µ–º–∞)
10. [–ß—Ç–æ –≥–æ—Ç–æ–≤–æ](#—á—Ç–æ-–≥–æ—Ç–æ–≤–æ)
11. [–ß—Ç–æ –Ω–µ –≥–æ—Ç–æ–≤–æ](#—á—Ç–æ-–Ω–µ-–≥–æ—Ç–æ–≤–æ)
12. [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞](#–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞)
13. [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
14. [Production Deployment](#production-deployment)

---

## –û –ø—Ä–æ–µ–∫—Ç–µ

**ThePred** - —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ prediction markets (—Ä—ã–Ω–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π) –≤ Telegram. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –Ω–∞ –∏—Å—Ö–æ–¥—ã —Å–æ–±—ã—Ç–∏–π –≤ –∫—Ä–∏–ø—Ç–µ, —Å–ø–æ—Ä—Ç–µ –∏ –ø–æ–ª–∏—Ç–∏–∫–µ, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—è —Ç–æ–∫–µ–Ω—ã PRED –Ω–∞ —Ç–æ—á–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è—Ö.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- üéØ **Prediction Markets** - —Å—Ç–∞–≤–∫–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- üí∞ **–¢–æ–∫–µ–Ω PRED** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≤–∞–ª—é—Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- üíé **TON Blockchain** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TON Wallet (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- üéÆ **–ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è** - –º–∏—Å—Å–∏–∏, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –ª–∏–¥–µ—Ä–±–æ—Ä–¥
- üì± **Telegram Mini App** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- üëë **–†–∞–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** - Bronze ‚Üí Silver ‚Üí Gold ‚Üí Diamond ‚Üí Grandmaster
- üìä **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- üì¢ **Broadcast —Å–∏—Å—Ç–µ–º–∞** - –º–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ —Å rate limiting
- üé´ **Support —Å–∏—Å—Ç–µ–º–∞** - —Ç–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

### –ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å:

1. **–ö–æ–º–∏—Å—Å–∏—è —Å —Ä—ã–Ω–∫–æ–≤** - 2-5% –æ—Ç pool
2. **–ü—Ä–µ–º–∏—É–º-–ø–æ–¥–ø–∏—Å–∫–∞** - —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ä—ã–Ω–∫–∏, –±–æ–Ω—É—Å—ã
3. **–†–µ–∫–ª–∞–º–∞** - –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Ä—ã–Ω–∫–∏, —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      TELEGRAM BOT                            ‚îÇ
‚îÇ                    (aiogram 3.x)                             ‚îÇ
‚îÇ                 @The_Pred_Bot                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    MINI APP (webapp)                         ‚îÇ
‚îÇ              Quart + Jinja2 + Tailwind CSS                   ‚îÇ
‚îÇ                  https://thepred.tech                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  BACKEND API (FastAPI)                       ‚îÇ
‚îÇ                  http://localhost:8000                       ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ   Auth     ‚îÇ  ‚îÇ  Markets   ‚îÇ  ‚îÇ    Bets    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  /auth/*   ‚îÇ  ‚îÇ /markets/* ‚îÇ  ‚îÇ  /bets/*   ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ  Missions  ‚îÇ  ‚îÇ Leaderboard‚îÇ  ‚îÇ   Admin    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ/missions/* ‚îÇ  ‚îÇ/leaderboard‚îÇ  ‚îÇ  /admin/*  ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ   Wallet   ‚îÇ  ‚îÇ  Support   ‚îÇ  ‚îÇ  Broadcast ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ /wallet/*  ‚îÇ  ‚îÇ /support/* ‚îÇ  ‚îÇ/admin/bcast‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ                               ‚îÇ
           ‚ñº                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL 15     ‚îÇ         ‚îÇ      Redis 7         ‚îÇ
‚îÇ   (Database)        ‚îÇ         ‚îÇ   (Cache/Sessions)   ‚îÇ
‚îÇ postgres:5432       ‚îÇ         ‚îÇ   redis:6379         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MinIO S3          ‚îÇ
‚îÇ  (File Storage)     ‚îÇ
‚îÇ https://thepred.store‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  TELEGRAM WORKER                             ‚îÇ
‚îÇ            Notification Queue Processor                      ‚îÇ
‚îÇ         Rate Limiting: 30 msg/sec (Telegram API)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  ADMIN PANEL (webapp)                        ‚îÇ
‚îÇ              Quart + Jinja2 + Chart.js                       ‚îÇ
‚îÇ                  http://localhost:8002                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  LANDING PAGE (webapp)                       ‚îÇ
‚îÇ                 Quart + Jinja2 + HTML/CSS                    ‚îÇ
‚îÇ                  http://localhost:8003                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend (FastAPI)

- **Framework**: FastAPI 0.109.0
- **ASGI Server**: Uvicorn 0.27.0
- **ORM**: SQLAlchemy 2.0.25 (async)
- **Database Driver**: asyncpg 0.29.0
- **Migrations**: Alembic 1.13.1
- **Validation**: Pydantic 2.5.3
- **Authentication**: python-jose (JWT)
- **Password Hashing**: passlib (bcrypt)
- **Cache**: Redis 5.0.1
- **File Storage**: boto3 (S3/MinIO)
- **Monitoring**: Sentry SDK 1.39.2

### Frontend (Mini App, Admin, Landing)

- **Framework**: Quart 0.19.4 (async Flask)
- **Templates**: Jinja2
- **CSS**: Tailwind CSS 3.x
- **Icons**: Heroicons, Lucide Icons
- **Charts**: Chart.js (admin panel)
- **HTTP Client**: aiohttp 3.9.1

### Bot

- **Framework**: aiogram 3.x
- **Async**: asyncio
- **HTTP Client**: aiohttp
- **Worker**: Standalone notification processor

### Database

- **PostgreSQL**: 15.x
- **Redis**: 7.x
- **S3 Storage**: MinIO (S3-compatible)

### DevOps

- **Containerization**: Docker + Docker Compose
- **Process Manager**: PM2 (production)
- **Web Server**: Nginx (reverse proxy, production)
- **SSL**: Let's Encrypt (Certbot)
- **Environment**: python-dotenv
- **Testing**: pytest (–≥–æ—Ç–æ–≤–æ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ThePred/
‚îú‚îÄ‚îÄ backend/                          # FastAPI Backend
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ endpoints/            # API endpoints
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ auth.py           # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (register, token)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ markets.py        # –†—ã–Ω–∫–∏ (list, detail, stats)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ bets.py           # –°—Ç–∞–≤–∫–∏ (create, my, detail)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ users.py          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (profile, stats, ban)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ missions.py       # –ú–∏—Å—Å–∏–∏ (list, claim, progress)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ leaderboard.py    # –õ–∏–¥–µ—Ä–±–æ—Ä–¥ (rankings, filters)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ wallet.py         # TON –∫–æ—à–µ–ª–µ–∫ (connect, deposit, withdraw)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ admin.py          # –ê–¥–º–∏–Ω–∫–∞ (markets, users, broadcast, stats)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ support.py        # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ (tickets, messages)
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ scheduler.py      # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (weekly rewards, cleanup)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/                     # Core utilities
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py             # Settings (env variables)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py           # DB connection pool
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis.py              # Redis connection
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ security.py           # JWT, password hashing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/                   # SQLAlchemy models
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py               # User (profile, balance, rank, ban)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ market.py             # Market (title, odds, pool, status)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bet.py                # Bet (user, market, amount, outcome)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mission.py            # Mission (type, progress, reward)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transaction.py        # Transaction (type, amount, balance)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wallet.py             # WalletAddress (TON address)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ support.py            # SupportTicket, SupportMessage
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_notification.py  # TelegramNotification (queue)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_mission.py       # UserMission (progress tracking)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                 # Business logic services
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_queue_service.py  # Queue management (add, get, mark)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mission_service.py    # Mission progress tracking
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ market_service.py     # Market resolution logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py                   # FastAPI app entry point
‚îÇ   ‚îú‚îÄ‚îÄ alembic/                      # Database migrations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ versions/                 # Migration files
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xxx_create_tables.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xxx_add_ban_system.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xxx_add_support_tickets.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xxx_add_notification_queue.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ xxx_add_broadcast_type.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env.py                    # Alembic config
‚îÇ   ‚îú‚îÄ‚îÄ telegram_worker.py            # Telegram notification worker (NEW)
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt              # Python dependencies
‚îÇ   ‚îî‚îÄ‚îÄ seed_data.py                  # Test data seeding script
‚îÇ
‚îú‚îÄ‚îÄ bot/                              # Telegram Bot
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # aiogram bot entry point
‚îÇ   ‚îú‚îÄ‚îÄ handlers/                     # Message handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py                  # /start command
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ support.py                # Support tickets
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common.py                 # Common handlers
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/                    # Telegram keyboards
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ inline.py                 # Inline keyboards
‚îÇ   ‚îú‚îÄ‚îÄ notification_worker.py        # Alternative worker (standalone)
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt              # Bot dependencies
‚îÇ
‚îú‚îÄ‚îÄ webapp/                           # Mini App (Quart)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # Quart app entry point
‚îÇ   ‚îú‚îÄ‚îÄ api_client.py                 # Backend API client (async)
‚îÇ   ‚îú‚îÄ‚îÄ routes/                       # Flask routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ markets.py                # Markets pages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.py                # User profile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ missions.py               # Missions page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leaderboard.py            # Leaderboard page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ support.py                # Support tickets
‚îÇ   ‚îú‚îÄ‚îÄ templates/                    # Jinja2 templates
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.html                 # Base template
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html                # Markets list
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ market.html               # Market detail + betting
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.html              # User profile + stats
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ missions.html             # Missions + claim
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leaderboard.html          # Rankings
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ support.html              # Support tickets
‚îÇ   ‚îú‚îÄ‚îÄ static/                       # Static files
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/                      # Custom CSS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/                       # Custom JavaScript
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ icons/                    # Icons, images
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt              # Webapp dependencies
‚îÇ
‚îú‚îÄ‚îÄ admin/                            # Admin Panel (Quart)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # Quart admin app
‚îÇ   ‚îú‚îÄ‚îÄ routes/                       # Admin routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.py              # Dashboard stats
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ markets.py                # Market management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py                  # User management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ broadcast.py              # Broadcast system
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ support.py                # Support ticket management
‚îÇ   ‚îú‚îÄ‚îÄ templates/                    # Admin templates
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.html                 # Admin base template
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html            # Stats dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ markets.html              # Markets CRUD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.html                # Users management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ broadcast.html            # Broadcast interface (NEW)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ support.html              # Support tickets
‚îÇ   ‚îú‚îÄ‚îÄ static/                       # Admin static files
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt              # Admin dependencies
‚îÇ
‚îú‚îÄ‚îÄ landing/                          # Landing Page (Quart)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                       # Landing app
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html                # Main landing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index_last.html           # Latest version
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ
‚îú‚îÄ‚îÄ database/                         # Database scripts
‚îÇ   ‚îú‚îÄ‚îÄ migrations/                   # Manual migrations
‚îÇ   ‚îî‚îÄ‚îÄ scripts/                      # Utility scripts
‚îÇ       ‚îî‚îÄ‚îÄ cleanup.sql               # Database cleanup
‚îÇ
‚îú‚îÄ‚îÄ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è/                     # Documentation
‚îÇ   ‚îú‚îÄ‚îÄ polymarket/                   # Polymarket research
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.md                   # Polymarket analysis
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ example.md                # Examples
‚îÇ   ‚îî‚îÄ‚îÄ architecture/                 # Architecture docs
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml                # Docker orchestration (dev)
‚îú‚îÄ‚îÄ docker-compose.prod.yml           # Docker production config
‚îú‚îÄ‚îÄ Makefile                          # Development commands
‚îú‚îÄ‚îÄ .env                              # Environment variables
‚îú‚îÄ‚îÄ .env.example                      # Environment template
‚îú‚îÄ‚îÄ README.md                         # English README
‚îú‚îÄ‚îÄ TODO.md                           # Task tracker
‚îî‚îÄ‚îÄ CLAUDE.md                         # This file (Russian docs)
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. Backend API (FastAPI)

**–ü–æ—Ä—Ç**: 8000
**Production**: –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ PM2
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8000/docs

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:

##### 1.1 Auth (`/auth`)
```python
# backend/app/api/endpoints/auth.py
POST /auth/register         # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
POST /auth/token            # –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Telegram ID
- JWT —Ç–æ–∫–µ–Ω—ã (24h expiration)
- –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: 10,000 PRED
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ 19 –º–∏—Å—Å–∏–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

##### 1.2 Markets (`/markets`)
```python
# backend/app/api/endpoints/markets.py
GET  /markets/              # –°–ø–∏—Å–æ–∫ —Ä—ã–Ω–∫–æ–≤ (—Ñ–∏–ª—å—Ç—Ä—ã, –ø–æ–∏—Å–∫)
GET  /markets/{id}          # –î–µ—Ç–∞–ª–∏ —Ä—ã–Ω–∫–∞
GET  /markets/{id}/stats    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä—ã–Ω–∫–∞
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**:
- `category`: Crypto, Sports, Politics, Tech
- `status`: Active, Resolved, Cancelled
- `promoted`: true/false
- `search`: –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- –¢–µ–∫—É—â–∏–µ odds (YES/NO)
- Total pool size
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –í–∞—à–∏ —Å—Ç–∞–≤–∫–∏ –Ω–∞ —Ä—ã–Ω–∫–µ
- –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

##### 1.3 Bets (`/bets`)
```python
# backend/app/api/endpoints/bets.py
POST /bets/                 # –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–≤–∫—É
GET  /bets/my               # –ú–æ–∏ —Å—Ç–∞–≤–∫–∏ (—Ñ–∏–ª—å—Ç—Ä—ã)
GET  /bets/{id}             # –î–µ—Ç–∞–ª–∏ —Å—Ç–∞–≤–∫–∏
```

**–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç odds –Ω–∞ –æ—Å–Ω–æ–≤–µ AMM (Automated Market Maker)
- Formula: `odds = total_pool / (outcome_pool + amount)`
- Potential win —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ –ë–î (—Å–ø–∏—Å–∞–Ω–∏–µ PRED)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–°—Ç–∞—Ç—É—Å—ã —Å—Ç–∞–≤–∫–∏**:
- `Pending` - —Ä—ã–Ω–æ–∫ –∞–∫—Ç–∏–≤–µ–Ω
- `Won` - —Å—Ç–∞–≤–∫–∞ –≤—ã–∏–≥—Ä–∞–ª–∞
- `Lost` - —Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–ª–∞
- `Refunded` - —Ä—ã–Ω–æ–∫ –æ—Ç–º–µ–Ω–µ–Ω

##### 1.4 Users (`/users`)
```python
# backend/app/api/endpoints/users.py
GET  /users/me              # –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
GET  /users/me/stats        # –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET  /users/{id}            # –ü—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
```

**–ü—Ä–æ—Ñ–∏–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç**:
- Balance (PRED, TON)
- Rank (Bronze ‚Üí Grandmaster)
- Statistics (Win Rate, Total Wins, Win Streak)
- Bet history
- Referral info
- Ban status

**–†–∞–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**:
- Bronze: 0-10 wins
- Silver: 11-25 wins
- Gold: 26-50 wins
- Diamond: 51-100 wins
- Grandmaster: 100+ wins

##### 1.5 Missions (`/missions`)
```python
# backend/app/api/endpoints/missions.py
GET  /missions/             # –°–ø–∏—Å–æ–∫ –º–∏—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /missions/{id}/claim   # –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
```

**19 —Ç–∏–ø–æ–≤ –º–∏—Å—Å–∏–π**:

1. **First Bet** - –°–¥–µ–ª–∞–π –ø–µ—Ä–≤—É—é —Å—Ç–∞–≤–∫—É (+500 PRED)
2. **5 Bets** - –°–¥–µ–ª–∞–π 5 —Å—Ç–∞–≤–æ–∫ (+1000 PRED)
3. **10 Bets** - –°–¥–µ–ª–∞–π 10 —Å—Ç–∞–≤–æ–∫ (+2000 PRED)
4. **Win Streak 3** - –í—ã–∏–≥—Ä–∞–π 3 –ø–æ–¥—Ä—è–¥ (+1500 PRED)
5. **Win Streak 5** - –í—ã–∏–≥—Ä–∞–π 5 –ø–æ–¥—Ä—è–¥ (+3000 PRED)
6. **Bet on Crypto** - –°—Ç–∞–≤–∫–∞ –Ω–∞ –∫—Ä–∏–ø—Ç—É (+500 PRED)
7. **Bet on Sports** - –°—Ç–∞–≤–∫–∞ –Ω–∞ —Å–ø–æ—Ä—Ç (+500 PRED)
8. **Bet on Politics** - –°—Ç–∞–≤–∫–∞ –Ω–∞ –ø–æ–ª–∏—Ç–∏–∫—É (+500 PRED)
9. **High Roller** - –°—Ç–∞–≤–∫–∞ 1000+ PRED (+1000 PRED)
10. **Lucky 7** - –í—ã–∏–≥—Ä–∞–π 7 —Å—Ç–∞–≤–æ–∫ (+2500 PRED)
11. **Daily Active** - 7 –¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (+1500 PRED)
12. **Referral** - –ü—Ä–∏–≤–µ–¥–∏ –¥—Ä—É–≥–∞ (+2000 PRED)
13. **Silver Rank** - –î–æ—Å—Ç–∏–≥–Ω–∏ Silver (+1000 PRED)
14. **Gold Rank** - –î–æ—Å—Ç–∏–≥–Ω–∏ Gold (+2500 PRED)
15. **Diamond Rank** - –î–æ—Å—Ç–∏–≥–Ω–∏ Diamond (+5000 PRED)
16. **Grandmaster Rank** - –î–æ—Å—Ç–∏–≥–Ω–∏ Grandmaster (+10000 PRED)
17. **Total Volume 10k** - 10k PRED –æ–±—ä–µ–º (+3000 PRED)
18. **Total Volume 50k** - 50k PRED –æ–±—ä–µ–º (+10000 PRED)
19. **Total Volume 100k** - 100k PRED –æ–±—ä–µ–º (+25000 PRED)

**–ú–µ—Ö–∞–Ω–∏–∫–∞**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- Claim –Ω–∞–≥—Ä–∞–¥—ã –∫–æ–≥–¥–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å == target
- –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –º–∏—Å—Å–∏–∏

##### 1.6 Leaderboard (`/leaderboard`)
```python
# backend/app/api/endpoints/leaderboard.py
GET /leaderboard/           # –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

**–¢–∏–ø—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏**:
- `profit` - –ø–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º PRED (default)
- `win_rate` - –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É –ø–æ–±–µ–¥
- `win_streak` - –ø–æ —Ç–µ–∫—É—â–µ–π —Å–µ—Ä–∏–∏ –ø–æ–±–µ–¥
- `total_wins` - –ø–æ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–±–µ–¥

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `limit`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (default: 100)
- `offset`: —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- `sort_by`: —Ç–∏–ø —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

##### 1.7 Wallet (`/wallet`) - –í –†–ê–ó–†–ê–ë–û–¢–ö–ï
```python
# backend/app/api/endpoints/wallet.py
POST /wallet/connect        # –ü–æ–¥–∫–ª—é—á–∏—Ç—å TON wallet
POST /wallet/deposit        # –ü–æ–ø–æ–ª–Ω–∏—Ç—å PRED —á–µ—Ä–µ–∑ TON
POST /wallet/withdraw       # –í—ã–≤–µ—Å—Ç–∏ PRED –≤ TON
```

**–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ TON Connect
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: 1 TON = 1000 PRED
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç: 0.1 TON
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥: 100 PRED
- –ö–æ–º–∏—Å—Å–∏—è –≤—ã–≤–æ–¥–∞: 5%

##### 1.8 Admin (`/admin`)
```python
# backend/app/api/endpoints/admin.py
# Markets
POST   /admin/markets                  # –°–æ–∑–¥–∞—Ç—å —Ä—ã–Ω–æ–∫
POST   /admin/markets/{id}/resolve     # –†–∞–∑—Ä–µ—à–∏—Ç—å —Ä—ã–Ω–æ–∫
PATCH  /admin/markets/{id}             # –û–±–Ω–æ–≤–∏—Ç—å —Ä—ã–Ω–æ–∫
DELETE /admin/markets/{id}             # –£–¥–∞–ª–∏—Ç—å —Ä—ã–Ω–æ–∫

# Users
GET    /admin/users                    # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
PATCH  /admin/users/{id}               # –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST   /admin/users/{id}/ban           # –ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST   /admin/users/{id}/unban         # –†–∞–∑–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# Broadcast (NEW)
POST   /admin/broadcast                # –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞

# Stats
GET    /admin/stats                    # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

**Broadcast —Å–∏—Å—Ç–µ–º–∞**:
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º (–¥–æ 1000 —Å–∏–º–≤–æ–ª–æ–≤)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤)
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ S3/MinIO
- –û—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑ TelegramQueueService
- Rate limiting —á–µ—Ä–µ–∑ Telegram Worker
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: HTML, Markdown
- Target: –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π ID

**Market Resolution**:
- –í—ã–±–æ—Ä –∏—Å—Ö–æ–¥–∞: YES, NO, CANCELLED
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –≤—ã–ø–ª–∞—Ç
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å

##### 1.9 Support (`/support`)
```python
# backend/app/api/endpoints/support.py
GET  /support/tickets                  # –ú–æ–∏ —Ç–∏–∫–µ—Ç—ã
POST /support/tickets                  # –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç
GET  /support/tickets/{id}             # –î–µ—Ç–∞–ª–∏ —Ç–∏–∫–µ—Ç–∞
POST /support/tickets/{id}/messages    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
POST /support/tickets/{id}/close       # –ó–∞–∫—Ä—ã—Ç—å —Ç–∏–∫–µ—Ç

# Admin
GET  /admin/support/tickets            # –í—Å–µ —Ç–∏–∫–µ—Ç—ã
POST /admin/support/tickets/{id}/reply # –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Ç–∏–∫–µ—Ç
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: Low, Medium, High, Urgent
- –°—Ç–∞—Ç—É—Å—ã: Open, In Progress, Waiting User, Closed
- –í–ª–æ–∂–µ–Ω–∏—è (—Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ S3)
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∞–¥–º–∏–Ω–∞

##### 1.10 Scheduler (`/scheduler`)
```python
# backend/app/api/endpoints/scheduler.py
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (APScheduler)

Weekly Leaderboard Rewards (–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 00:00 UTC):
- –¢–æ–ø 10 –ø–æ–ª—É—á–∞—é—Ç –Ω–∞–≥—Ä–∞–¥—ã
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
- –°–±—Ä–æ—Å weekly stats

Cleanup Old Data (–ï–∂–µ–¥–Ω–µ–≤–Ω–æ 03:00 UTC):
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (>30 –¥–Ω–µ–π)
- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤
```

---

### 2. Telegram Bot (aiogram)

**–§–∞–π–ª**: `bot/main.py`
**–ë–æ—Ç**: @The_Pred_Bot

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

##### 2.1 –ö–æ–º–∞–Ω–¥—ã
```python
/start              # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
/help               # –ü–æ–º–æ—â—å
/support            # –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
/balance            # –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å
/stats              # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```

##### 2.2 WebApp Integration
```python
# –ö–Ω–æ–ø–∫–∞ "üéØ Open Markets" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App
webapp_url = f"{WEBAPP_URL}?telegram_id={user.id}&username={user.username}"
```

##### 2.3 Support Tickets
```python
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ —á–µ—Ä–µ–∑ FSM (Finite State Machine)
1. /support - –Ω–∞—á–∞–ª–æ –¥–∏–∞–ª–æ–≥–∞
2. –í—ã–±–æ—Ä –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (Low/Medium/High/Urgent)
3. –í–≤–æ–¥ —Ç–µ–º—ã —Ç–∏–∫–µ—Ç–∞
4. –í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã
5. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ
6. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –≤ backend
7. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º
```

##### 2.4 Notifications
```python
# –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏
- Market Resolved (—Ç–≤–æ–π —Ä—ã–Ω–æ–∫ –∑–∞–∫—Ä—ã–ª—Å—è)
- Bet Won/Lost (—Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç–∞–≤–∫–∏)
- Mission Completed (–º–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)
- Leaderboard Reward (–Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –º–µ—Å—Ç–æ)
- Broadcast (–º–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –æ—Ç –∞–¥–º–∏–Ω–∞)
- Support Reply (–æ—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∞ –≤ —Ç–∏–∫–µ—Ç–µ)
```

---

### 3. Telegram Worker

**–§–∞–π–ª**: `backend/telegram_worker.py`
**–¢–∏–ø**: Standalone process (PM2)

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```python
class TelegramWorker:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—á–µ—Ä–µ–¥–∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

    –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
    - Rate limiting: 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫—É–Ω–¥—É (–ª–∏–º–∏—Ç Telegram)
    - Batch processing: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ 30 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑
    - Error handling: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
    - Retry logic: –¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
    - Sleep: 1 —Å–µ–∫ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏, 5 —Å–µ–∫ –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
    """
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

##### 3.1 Process Loop
```python
async def _process_loop(self):
    """
    –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏

    1. –ü–æ–ª—É—á–∏—Ç—å pending —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –ë–î (SKIP LOCKED)
    2. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (asyncio.gather)
    3. Sleep –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è rate limit
    4. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
    """
```

##### 3.2 Send Message
```python
async def _send_message(self, notification):
    """
    –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

    –ü–æ–¥–¥–µ—Ä–∂–∫–∞:
    - Text messages (HTML, Markdown)
    - Photo with caption
    - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ notification_metadata

    –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
    - TelegramForbiddenError -> PERMANENT_FAILURE (user blocked bot)
    - TelegramBadRequest -> PERMANENT_FAILURE (invalid data)
    - TelegramAPIError -> FAILED (retry)
    - Other errors -> FAILED (retry)
    """
```

##### 3.3 Status Updates
```python
# –°—Ç–∞—Ç—É—Å—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
PENDING -> PROCESSING -> SENT      # –£—Å–ø–µ—à–Ω–æ
PENDING -> PROCESSING -> FAILED -> ... -> SENT  # –° retry
PENDING -> PROCESSING -> PERMANENT_FAILURE  # –ù–µ—Ç retry
```

#### Integration:

```python
# backend/app/services/telegram_queue_service.py
class TelegramQueueService:
    """
    –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é

    –ú–µ—Ç–æ–¥—ã:
    - add_notification(): –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
    - get_pending_messages(): –ø–æ–ª—É—á–∏—Ç—å pending (FOR UPDATE SKIP LOCKED)
    - mark_processing(): –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
    - mark_sent(): –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
    - mark_failed(): –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ—à–∏–±–∫–∞ (—Å/–±–µ–∑ retry)
    """
```

#### –ó–∞–ø—É—Å–∫:

```bash
# Development
cd backend
BOT_TOKEN="your_token" python telegram_worker.py

# Production (PM2)
pm2 start telegram_worker.py --name telegram-worker --interpreter python3
pm2 logs telegram-worker
```

---

### 4. Mini App (Webapp)

**–ü–æ—Ä—Ç**: 8001
**Production**: https://thepred.tech
**Framework**: Quart (async Flask)

#### –°—Ç—Ä–∞–Ω–∏—Ü—ã:

##### 4.1 Markets (`/`)
```html
<!-- webapp/templates/index.html -->
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä—ã–Ω–∫–æ–≤
- –§–∏–ª—å—Ç—Ä—ã: All, Crypto, Sports, Politics, Tech
- Promoted markets (–≤—ã–¥–µ–ª–µ–Ω—ã)
- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- Sorting: Latest, Ending Soon, Most Popular
- Infinite scroll (pagination)
```

##### 4.2 Market Detail (`/market/<id>`)
```html
<!-- webapp/templates/market.html -->
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä—ã–Ω–∫–µ
- –¢–µ–∫—É—â–∏–µ odds (YES/NO —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏)
- Pool size, participants count
- Betting interface:
  - –í—ã–±–æ—Ä –∏—Å—Ö–æ–¥–∞ (YES/NO)
  - –í–≤–æ–¥ —Å—É–º–º—ã
  - –†–∞—Å—á–µ—Ç potential win
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
- –¢–≤–æ–∏ —Å—Ç–∞–≤–∫–∏ –Ω–∞ —ç—Ç–æ–º —Ä—ã–Ω–∫–µ
- –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –¥—Ä—É–≥–∏—Ö)
```

##### 4.3 Profile (`/profile`)
```html
<!-- webapp/templates/profile.html -->
–°–µ–∫—Ü–∏–∏:
1. Balance Card
   - PRED balance (—Å –∞–Ω–∏–º–∞—Ü–∏–µ–π)
   - TON balance (–µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω)
   - Connect Wallet button (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

2. Stats Card
   - Current Rank (—Å –∏–∫–æ–Ω–∫–æ–π)
   - Win Rate (—Ü–≤–µ—Ç–Ω–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä)
   - Total Wins / Total Bets
   - Win Streak (–æ–≥–æ–Ω—å –µ—Å–ª–∏ >0)

3. Bet History
   - –§–∏–ª—å—Ç—Ä—ã: All, Pending, Won, Lost
   - –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞–≤–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ
   - Pagination
```

##### 4.4 Missions (`/missions`)
```html
<!-- webapp/templates/missions.html -->
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- Grid –∫–∞—Ä—Ç–æ—á–µ–∫ –º–∏—Å—Å–∏–π (19 —à—Ç—É–∫)
- Progress bar –¥–ª—è –∫–∞–∂–¥–æ–π –º–∏—Å—Å–∏–∏
- Claim button (–∫–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)
- Claimed badge (–∫–æ–≥–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞ –Ω–∞–≥—Ä–∞–¥–∞)
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º:
  - Betting Missions
  - Streak Missions
  - Category Missions
  - Rank Missions
  - Volume Missions
```

##### 4.5 Leaderboard (`/leaderboard`)
```html
<!-- webapp/templates/leaderboard.html -->
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- Tabs –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:
  - üí∞ Profit Leaders
  - üéØ Win Rate Leaders
  - üî• Win Streak Leaders
  - üèÜ Most Wins Leaders
- Top 3 —Å –±–æ–ª—å—à–∏–º–∏ –º–µ–¥–∞–ª—è–º–∏
- –°–ø–∏—Å–æ–∫ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ 4-100
- "Your Position" card –≤–Ω–∏–∑—É
- Real-time updates
```

#### API Client:

```python
# webapp/api_client.py
class APIClient:
    """
    Async HTTP client –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Backend API

    –ú–µ—Ç–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö endpoints:
    - auth (register, token)
    - markets (list, detail, stats)
    - bets (create, my, detail)
    - users (profile, stats)
    - missions (list, claim)
    - leaderboard (get)
    - wallet (connect, deposit, withdraw)
    """
```

---

### 5. Admin Panel

**–ü–æ—Ä—Ç**: 8002
**Production**: –î–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ Nginx proxy
**Framework**: Quart + Chart.js

#### –†–∞–∑–¥–µ–ª—ã:

##### 5.1 Dashboard (`/admin`)
```html
<!-- admin/templates/dashboard.html -->
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- Total Users (—Å —Ä–æ—Å—Ç–æ–º)
- Active Markets
- Total Bets (–∑–∞ –≤—Å–µ –≤—Ä–µ–º—è)
- Total Volume (PRED)

–ì—Ä–∞—Ñ–∏–∫–∏ (Chart.js):
- Users Growth (–ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫)
- Bets by Category (–∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)
- Daily Volume (—Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)
- Top Markets (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞)
```

##### 5.2 Markets Management (`/admin/markets`)
```html
<!-- admin/templates/markets.html -->
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö —Ä—ã–Ω–∫–æ–≤
- –§–∏–ª—å—Ç—Ä—ã: Status, Category
- –î–µ–π—Å—Ç–≤–∏—è:
  - ‚úèÔ∏è Edit (modal)
  - ‚úÖ Resolve (–≤—ã–±–æ—Ä –∏—Å—Ö–æ–¥–∞)
  - üîù Promote/Unpromote
  - üóëÔ∏è Delete (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)

Create Market Modal:
- Title (max 500 chars)
- Description (rich text)
- Category (select)
- End Date (datepicker)
- Promoted (checkbox)
```

##### 5.3 Users Management (`/admin/users`)
```html
<!-- admin/templates/users.html -->
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Search by telegram_id, username
- –§–∏–ª—å—Ç—Ä—ã: Rank, Banned
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: Balance, Total Bets, Win Rate

–î–µ–π—Å—Ç–≤–∏—è:
- üëÅÔ∏è View Activity (modal —Å –∏—Å—Ç–æ—Ä–∏–µ–π)
- ‚úèÔ∏è Edit Balance (modal)
- üö´ Ban/Unban
- üìä View Stats

User Activity Modal:
- Recent bets
- Mission progress
- Transaction history
- Support tickets
```

##### 5.4 Broadcast System (`/admin/broadcast`) - NEW
```html
<!-- admin/templates/broadcast.html -->
–°–µ–∫—Ü–∏–∏:

1. Rich Text Editor
   - Formatting toolbar:
     - Bold, Italic, Underline, Strikethrough
     - Code, Link, Unordered List, Ordered List
   - Emoji Picker (32 emojis):
     - üòäüî•üíéüéØüí∞üìàüöÄ‚ö°Ô∏è‚ú®üéâ
     - üéÅüí™üèÜüëëüíØüåü‚≠êÔ∏èüéÆüìä
     - üí∏ü§ëüíµüí¥üí∑üí∂ü™ôüìâüìà
     - ‚ù§Ô∏èüëçüëèüôåü§ù
   - Character counter:
     - 0 / 4096 (–±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
     - 0 / 1000 (—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º)
   - Visual warning –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

2. Image Upload
   - Drag & drop zone
   - File picker (images only)
   - Preview —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∏—è
   - Auto-upload to S3/MinIO

3. Settings
   - Parse Mode: HTML / Markdown
   - Target:
     - All Users (broadcast)
     - Specific User (by telegram_id)

4. Preview
   - Live preview —Å–æ–æ–±—â–µ–Ω–∏—è
   - Preview –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - HTML rendering

5. Send Button
   - Validation –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
   - Success toast —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
   - Estimated delivery time

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏:
- –°–æ–æ–±—â–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
- Telegram Worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å rate limiting
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ queued —Å–æ–æ–±—â–µ–Ω–∏–π
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
```javascript
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç —Å–∏–º–≤–æ–ª–æ–≤
function updateCharCounter() {
    const message = document.getElementById('message').value;
    const charCount = message.length;
    const maxChars = uploadedImageFile ? 1000 : 4096;

    counter.textContent = `${charCount} / ${maxChars} characters`;

    if (charCount > maxChars) {
        counter.classList.add('text-red-400');
        warning.classList.remove('hidden');
    } else {
        counter.classList.remove('text-red-400');
        warning.classList.add('hidden');
    }
}

// FormData submission
const formData = new FormData();
formData.append('message', message);
formData.append('target', target);
formData.append('parse_mode', parseMode);
if (telegram_id) formData.append('telegram_id', telegram_id);
if (uploadedImageFile) formData.append('image', uploadedImageFile);
```

##### 5.5 Support Tickets (`/admin/support`)
```html
<!-- admin/templates/support.html -->
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∏–∫–µ—Ç–æ–≤
- –§–∏–ª—å—Ç—Ä—ã: Status, Priority
- Badge —Ü–≤–µ—Ç–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É

Ticket Detail Modal:
- User info
- Ticket subject, description
- Attached photo (–µ—Å–ª–∏ –µ—Å—Ç—å)
- Message thread
- Reply form (—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–æ—Ç–æ)
- Actions: Close Ticket, Change Status
```

---

### 6. Landing Page

**–ü–æ—Ä—Ç**: 8003
**–§–∞–π–ª**: `landing/templates/index_last.html`

#### –°–µ–∫—Ü–∏–∏:

```html
1. Hero Section
   - Gradient background
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫: "Prediction Markets –≤ Telegram"
   - 3 –ø—Ä–∏–º–µ—Ä–∞ —Ä—ã–Ω–∫–æ–≤ (Crypto, Sports, Politics)
   - CTA button: "–û—Ç–∫—Ä—ã—Ç—å –≤ Telegram"

2. Philosophy Section
   - "–°–∏–ª–∞ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑—É–º–∞"
   - –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ prediction markets
   - –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏

3. How It Works (3 —à–∞–≥–∞)
   - –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ ‚Üí –í—ã–±–µ—Ä–∏ —Å–æ–±—ã—Ç–∏–µ ‚Üí –î–µ–ª–∞–π –ø—Ä–æ–≥–Ω–æ–∑
   - Step-by-step –∞–Ω–∏–º–∞—Ü–∏—è

4. Features Grid
   - Real Markets
   - Smart Odds
   - Win Together
   - –ö–∞–∂–¥–∞—è feature —Å –∏–∫–æ–Ω–∫–æ–π –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º

5. Gamification Section
   - –ú–∏—Å—Å–∏–∏, –†–∞–Ω–≥–∏, –õ–∏–¥–µ—Ä–±–æ—Ä–¥
   - –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

6. AI Assistant (Coming Soon)
   - –ë—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - –¢–∏–∑–µ—Ä

7. Social Proof
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (users, markets, volume)
   - –°—á–µ—Ç—á–∏–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π

8. Footer
   - Copyright
   - Social links (Telegram, Twitter, GitHub)
```

**–î–∏–∑–∞–π–Ω**:
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π (mobile, tablet, desktop)
- –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã, glass effects
- Smooth scroll animations (AOS.js)
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
- SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### PostgreSQL Schema (11 —Ç–∞–±–ª–∏—Ü)

#### 1. `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

```sql
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    photo_url VARCHAR(500),

    -- Balances
    pred_balance DECIMAL(20,2) DEFAULT 10000.00 NOT NULL,
    ton_balance DECIMAL(20,2) DEFAULT 0.00 NOT NULL,

    -- Gamification
    rank VARCHAR(50) DEFAULT 'Bronze' NOT NULL,
    total_bets BIGINT DEFAULT 0 NOT NULL,
    total_wins BIGINT DEFAULT 0 NOT NULL,
    total_losses BIGINT DEFAULT 0 NOT NULL,
    win_streak BIGINT DEFAULT 0 NOT NULL,

    -- Referral
    referrer_id BIGINT REFERENCES users(id),
    referral_code VARCHAR(50) UNIQUE,

    -- Ban system
    is_banned BOOLEAN DEFAULT FALSE NOT NULL,
    ban_reason TEXT,
    banned_at TIMESTAMP WITH TIME ZONE,

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_referral_code ON users(referral_code);
CREATE INDEX idx_users_is_banned ON users(is_banned);
```

**–†–∞–Ω–≥–∏**:
- Bronze: 0-10 wins
- Silver: 11-25 wins
- Gold: 26-50 wins
- Diamond: 51-100 wins
- Grandmaster: 100+ wins

#### 2. `markets` - –†—ã–Ω–∫–∏

```sql
CREATE TABLE markets (
    id SERIAL PRIMARY KEY,
    title VARCHAR(500) NOT NULL,
    description TEXT,
    category VARCHAR(50) NOT NULL,  -- Crypto, Sports, Politics, Tech
    end_date TIMESTAMP WITH TIME ZONE NOT NULL,
    status VARCHAR(50) DEFAULT 'Active' NOT NULL,  -- Active, Resolved, Cancelled
    result VARCHAR(10),  -- YES, NO, NULL

    -- Pool tracking
    total_yes_bets BIGINT DEFAULT 0 NOT NULL,
    total_no_bets BIGINT DEFAULT 0 NOT NULL,
    total_pool BIGINT DEFAULT 0 NOT NULL,

    -- Admin
    promoted BOOLEAN DEFAULT FALSE NOT NULL,
    created_by INTEGER,

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_markets_category ON markets(category);
CREATE INDEX idx_markets_status ON markets(status);
CREATE INDEX idx_markets_end_date ON markets(end_date);
CREATE INDEX idx_markets_promoted ON markets(promoted);
```

**Categories**:
- Crypto: Bitcoin, Ethereum, TON, altcoins
- Sports: Football, Basketball, UFC, etc.
- Politics: Elections, referendums, appointments
- Tech: Product launches, IPOs, acquisitions

#### 3. `bets` - –°—Ç–∞–≤–∫–∏

```sql
CREATE TABLE bets (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) NOT NULL,
    market_id INTEGER REFERENCES markets(id) NOT NULL,

    -- Bet details
    outcome VARCHAR(10) NOT NULL,  -- YES, NO
    amount BIGINT NOT NULL,
    odds DECIMAL(10,2) NOT NULL,
    potential_win BIGINT NOT NULL,

    -- Status
    status VARCHAR(50) DEFAULT 'Pending' NOT NULL,  -- Pending, Won, Lost, Refunded

    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_bets_user_id ON bets(user_id);
CREATE INDEX idx_bets_market_id ON bets(market_id);
CREATE INDEX idx_bets_status ON bets(status);
CREATE INDEX idx_bets_created_at ON bets(created_at DESC);
```

**Odds calculation (AMM)**:
```python
# Automated Market Maker formula
total_pool = market.total_yes_bets + market.total_no_bets
outcome_pool = market.total_yes_bets if outcome == "YES" else market.total_no_bets

odds = (total_pool + amount) / (outcome_pool + amount)
potential_win = amount * odds
```

#### 4. `missions` - –ú–∏—Å—Å–∏–∏ (—à–∞–±–ª–æ–Ω—ã)

```sql
CREATE TABLE missions (
    id SERIAL PRIMARY KEY,
    mission_type VARCHAR(100) UNIQUE NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    icon VARCHAR(50),  -- Emoji –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∫–æ–Ω–∫–∏
    target INTEGER NOT NULL,
    reward INTEGER NOT NULL,
    category VARCHAR(50),  -- Betting, Streak, Category, Rank, Volume

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);
```

**19 –º–∏—Å—Å–∏–π** (–¥–µ—Ç–∞–ª–∏ —Å–º. –≤ —Ä–∞–∑–¥–µ–ª–µ Missions –≤—ã—à–µ)

#### 5. `user_missions` - –ü—Ä–æ–≥—Ä–µ—Å—Å –º–∏—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
CREATE TABLE user_missions (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) NOT NULL,
    mission_id INTEGER REFERENCES missions(id) NOT NULL,

    -- Progress tracking
    progress INTEGER DEFAULT 0 NOT NULL,
    claimed BOOLEAN DEFAULT FALSE NOT NULL,
    claimed_at TIMESTAMP WITH TIME ZONE,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,

    UNIQUE(user_id, mission_id)
);

CREATE INDEX idx_user_missions_user_id ON user_missions(user_id);
CREATE INDEX idx_user_missions_claimed ON user_missions(claimed);
```

**–ú–µ—Ö–∞–Ω–∏–∫–∞**:
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è 19 –∑–∞–ø–∏—Å–µ–π (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ –∫–∞–∂–¥—É—é –º–∏—Å—Å–∏—é)
- progress –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- claimed = true –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã

#### 6. `transactions` - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```sql
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) NOT NULL,

    -- Transaction details
    type VARCHAR(50) NOT NULL,  -- Bet, Win, Refund, Mission, Deposit, Withdraw, LeaderboardReward
    amount BIGINT NOT NULL,
    balance_before BIGINT NOT NULL,
    balance_after BIGINT NOT NULL,
    description TEXT,

    -- Related entities
    bet_id INTEGER REFERENCES bets(id),
    mission_id INTEGER REFERENCES missions(id),

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_transactions_type ON transactions(type);
CREATE INDEX idx_transactions_created_at ON transactions(created_at DESC);
```

**–¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**:
- Bet: —Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏
- Win: –≤—ã–ø–ª–∞—Ç–∞ –ø—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ
- Refund: –≤–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —Ä—ã–Ω–∫–∞
- Mission: –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –º–∏—Å—Å–∏—é
- LeaderboardReward: –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –º–µ—Å—Ç–æ –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ
- Deposit: –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ TON (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- Withdraw: –≤—ã–≤–æ–¥ –≤ TON (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

#### 7. `wallet_addresses` - TON –∫–æ—à–µ–ª—å–∫–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

```sql
CREATE TABLE wallet_addresses (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) UNIQUE NOT NULL,
    ton_address VARCHAR(255) NOT NULL,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_wallet_addresses_ton_address ON wallet_addresses(ton_address);
```

#### 8. `support_tickets` - –¢–∏–∫–µ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏

```sql
CREATE TYPE ticketstatus AS ENUM ('open', 'in_progress', 'waiting_user', 'closed');
CREATE TYPE ticketpriority AS ENUM ('low', 'medium', 'high', 'urgent');

CREATE TABLE support_tickets (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) NOT NULL,
    subject VARCHAR(255) NOT NULL,
    priority ticketpriority DEFAULT 'medium' NOT NULL,
    status ticketstatus DEFAULT 'open' NOT NULL,
    admin_replied BOOLEAN DEFAULT FALSE NOT NULL,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
    closed_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX idx_support_tickets_user_id ON support_tickets(user_id);
CREATE INDEX idx_support_tickets_status ON support_tickets(status);
CREATE INDEX idx_support_tickets_priority ON support_tickets(priority);
```

#### 9. `support_messages` - –°–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–∏–∫–µ—Ç–∞—Ö

```sql
CREATE TABLE support_messages (
    id SERIAL PRIMARY KEY,
    ticket_id INTEGER REFERENCES support_tickets(id) NOT NULL,
    user_id BIGINT REFERENCES users(id),  -- NULL –µ—Å–ª–∏ –æ—Ç –∞–¥–º–∏–Ω–∞
    is_admin BOOLEAN DEFAULT FALSE NOT NULL,
    message TEXT NOT NULL,
    attachment_url VARCHAR(500),  -- S3 URL –¥–ª—è —Ñ–æ—Ç–æ

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_support_messages_ticket_id ON support_messages(ticket_id);
CREATE INDEX idx_support_messages_created_at ON support_messages(created_at);
```

#### 10. `telegram_notifications_queue` - –û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```sql
CREATE TYPE notificationstatus AS ENUM (
    'PENDING',           -- –û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏
    'PROCESSING',        -- –í –ø—Ä–æ—Ü–µ—Å—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    'SENT',              -- –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
    'FAILED',            -- –û—à–∏–±–∫–∞ (–±—É–¥–µ—Ç retry)
    'PERMANENT_FAILURE'  -- –ù–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –æ—à–∏–±–∫–∞ (–±–µ–∑ retry)
);

CREATE TYPE notificationtype AS ENUM (
    'LEADERBOARD_REWARD',
    'MARKET_RESOLVED',
    'BET_WON',
    'BET_LOST',
    'MISSION_COMPLETED',
    'BROADCAST',         -- NEW: –º–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
    'SYSTEM'
);

CREATE TABLE telegram_notifications_queue (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT NOT NULL,
    user_id BIGINT REFERENCES users(id),

    -- Message content
    message_text TEXT NOT NULL,
    parse_mode VARCHAR(10) DEFAULT 'HTML',  -- HTML –∏–ª–∏ Markdown
    notification_type notificationtype NOT NULL,
    notification_metadata TEXT,  -- JSON –¥–ª—è –¥–æ–ø. –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, photo_url)

    -- Status tracking
    status notificationstatus DEFAULT 'PENDING' NOT NULL,
    attempts INTEGER DEFAULT 0 NOT NULL,
    max_attempts INTEGER DEFAULT 5 NOT NULL,

    -- Scheduling
    scheduled_at TIMESTAMP WITH TIME ZONE,  -- –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
    processing_at TIMESTAMP WITH TIME ZONE, -- –ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∞—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∞
    sent_at TIMESTAMP WITH TIME ZONE,       -- –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

    -- Errors
    error_message TEXT,
    last_error_at TIMESTAMP WITH TIME ZONE,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_notifications_status ON telegram_notifications_queue(status);
CREATE INDEX idx_notifications_telegram_id ON telegram_notifications_queue(telegram_id);
CREATE INDEX idx_notifications_scheduled_at ON telegram_notifications_queue(scheduled_at);
CREATE INDEX idx_notifications_created_at ON telegram_notifications_queue(created_at);
```

**Metadata examples**:
```json
// Broadcast —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
{
  "broadcast": true,
  "photo_url": "https://thepred.store/thepred-events/broadcast/20251108_123456_image.jpg"
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä—ã–Ω–∫–∞
{
  "market_id": 123,
  "market_title": "Will Bitcoin reach $100k by end of 2025?",
  "result": "YES"
}

// –í—ã–∏–≥—Ä—ã—à —Å—Ç–∞–≤–∫–∏
{
  "bet_id": 456,
  "market_id": 123,
  "amount_won": 2500
}
```

#### 11. `leaderboard_snapshots` - –°–Ω–∏–º–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```sql
CREATE TABLE leaderboard_snapshots (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id) NOT NULL,
    period VARCHAR(50) NOT NULL,  -- weekly, monthly, all_time

    -- Metrics
    position INTEGER NOT NULL,
    total_profit BIGINT NOT NULL,
    win_rate DECIMAL(5,2),
    win_streak INTEGER,
    total_wins INTEGER,

    -- Reward (–µ—Å–ª–∏ –ø–æ–ª—É—á–∏–ª)
    reward_amount INTEGER,
    rewarded BOOLEAN DEFAULT FALSE,

    snapshot_date DATE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_snapshots_period_date ON leaderboard_snapshots(period, snapshot_date);
CREATE INDEX idx_snapshots_user_period ON leaderboard_snapshots(user_id, period);
```

### Seed Data

**–§–∞–π–ª**: `backend/seed_data.py`

**20 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ä—ã–Ω–∫–æ–≤**:
- 7 Crypto: Bitcoin $100k, Ethereum $10k, TON $15, BNB $1000, Solana $500
- 6 Sports: Real Madrid win, Lakers championship, Ronaldo goals, UFC 300
- 4 Politics: Trump reelection, Russia-Ukraine, NATO expansion, UK elections
- 3 Tech: Apple AR glasses, AI surpass humans, Tesla $500

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞**:
```bash
cd backend
POSTGRES_HOST=localhost python3 seed_data.py
```

---

## API Endpoints

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ (40+ endpoints)

#### Auth
```
POST   /auth/register                 # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
POST   /auth/token                    # –ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
```

#### Markets
```
GET    /markets/                      # –°–ø–∏—Å–æ–∫ —Ä—ã–Ω–∫–æ–≤
  ?category=Crypto                    # –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  &status=Active                      # –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
  &promoted=true                      # –¢–æ–ª—å–∫–æ promoted
  &search=bitcoin                     # –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
  &limit=20&offset=0                  # Pagination

GET    /markets/{id}                  # –î–µ—Ç–∞–ª–∏ —Ä—ã–Ω–∫–∞
GET    /markets/{id}/stats            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä—ã–Ω–∫–∞
```

#### Bets
```
POST   /bets/                         # –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞–≤–∫—É
  Body: {
    "market_id": 1,
    "outcome": "YES",
    "amount": 100
  }

GET    /bets/my                       # –ú–æ–∏ —Å—Ç–∞–≤–∫–∏
  ?status=Pending                     # –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
  &market_id=1                        # –§–∏–ª—å—Ç—Ä –ø–æ —Ä—ã–Ω–∫—É
  &limit=50&offset=0

GET    /bets/{id}                     # –î–µ—Ç–∞–ª–∏ —Å—Ç–∞–≤–∫–∏
```

#### Users
```
GET    /users/me                      # –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
GET    /users/me/stats                # –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET    /users/{id}                    # –ü—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
```

#### Missions
```
GET    /missions/                     # –°–ø–∏—Å–æ–∫ –º–æ–∏—Ö –º–∏—Å—Å–∏–π
POST   /missions/{id}/claim           # –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
```

#### Leaderboard
```
GET    /leaderboard/                  # –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  ?sort_by=profit                     # profit, win_rate, win_streak, total_wins
  &limit=100&offset=0
```

#### Wallet (–í –†–ê–ó–†–ê–ë–û–¢–ö–ï)
```
POST   /wallet/connect                # –ü–æ–¥–∫–ª—é—á–∏—Ç—å TON wallet
  Body: {"ton_address": "EQ..."}

POST   /wallet/deposit                # –î–µ–ø–æ–∑–∏—Ç TON ‚Üí PRED
  Body: {"amount_ton": 1.5}

POST   /wallet/withdraw               # –í—ã–≤–æ–¥ PRED ‚Üí TON
  Body: {"amount_pred": 1500}
```

#### Support
```
# User endpoints
GET    /support/tickets               # –ú–æ–∏ —Ç–∏–∫–µ—Ç—ã
POST   /support/tickets               # –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç
  Body: {
    "subject": "–ù–µ –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É",
    "priority": "high",
    "message": "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã",
    "attachment": <file>
  }

GET    /support/tickets/{id}          # –î–µ—Ç–∞–ª–∏ —Ç–∏–∫–µ—Ç–∞
POST   /support/tickets/{id}/messages # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
POST   /support/tickets/{id}/close    # –ó–∞–∫—Ä—ã—Ç—å —Ç–∏–∫–µ—Ç

# Admin endpoints
GET    /admin/support/tickets         # –í—Å–µ —Ç–∏–∫–µ—Ç—ã
  ?status=open&priority=high

POST   /admin/support/tickets/{id}/reply  # –û—Ç–≤–µ—Ç–∏—Ç—å
POST   /admin/support/tickets/{id}/status # –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```

#### Admin - Markets
```
POST   /admin/markets                 # –°–æ–∑–¥–∞—Ç—å —Ä—ã–Ω–æ–∫
  Body: {
    "title": "Will Bitcoin reach $100k?",
    "description": "...",
    "category": "Crypto",
    "end_date": "2025-12-31T23:59:59Z",
    "promoted": false
  }

PATCH  /admin/markets/{id}            # –û–±–Ω–æ–≤–∏—Ç—å —Ä—ã–Ω–æ–∫
POST   /admin/markets/{id}/resolve    # –†–∞–∑—Ä–µ—à–∏—Ç—å —Ä—ã–Ω–æ–∫
  Body: {"result": "YES"}             # YES, NO, CANCELLED

DELETE /admin/markets/{id}            # –£–¥–∞–ª–∏—Ç—å —Ä—ã–Ω–æ–∫
```

#### Admin - Users
```
GET    /admin/users                   # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  ?limit=50&offset=0
  &search=username
  &rank=Diamond
  &is_banned=false

PATCH  /admin/users/{id}              # –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  Body: {
    "pred_balance": 5000,
    "rank": "Gold"
  }

POST   /admin/users/{id}/ban          # –ó–∞–±–∞–Ω–∏—Ç—å
  Body: {"reason": "Cheating"}

POST   /admin/users/{id}/unban        # –†–∞–∑–±–∞–Ω–∏—Ç—å
```

#### Admin - Broadcast (NEW)
```
POST   /admin/broadcast               # –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
  Content-Type: multipart/form-data

  Fields:
    message: "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
    target: "all" | "specific"
    telegram_id: 123456 (–µ—Å–ª–∏ target=specific)
    parse_mode: "HTML" | "Markdown"
    image: <file> (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

  Response: {
    "total_recipients": 150,
    "queued": 150,
    "message": "Broadcast queued for 150 users"
  }
```

#### Admin - Stats
```
GET    /admin/stats                   # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  Response: {
    "total_users": 150,
    "active_markets": 12,
    "total_bets": 543,
    "total_volume": 125000,
    "users_growth": [...],
    "bets_by_category": {...},
    "daily_volume": [...]
  }
```

---

## –°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    APPLICATION EVENTS                     ‚îÇ
‚îÇ   (Bet Won, Market Resolved, Mission Completed, etc.)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              TelegramQueueService.add_notification()      ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  await TelegramQueueService.add_notification(             ‚îÇ
‚îÇ      db=db,                                               ‚îÇ
‚îÇ      telegram_id=user.telegram_id,                        ‚îÇ
‚îÇ      message_text="üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –≤—ã–∏–≥—Ä–∞–ª–∞!" ‚îÇ
‚îÇ      notification_type=NotificationType.BET_WON,          ‚îÇ
‚îÇ      user_id=user.id,                                     ‚îÇ
‚îÇ      metadata={"bet_id": 123, "amount_won": 2500}         ‚îÇ
‚îÇ  )                                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            telegram_notifications_queue (PostgreSQL)      ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  Status: PENDING ‚Üí PROCESSING ‚Üí SENT/FAILED              ‚îÇ
‚îÇ  FOR UPDATE SKIP LOCKED (concurrent processing)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   TELEGRAM WORKER                         ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  While True:                                              ‚îÇ
‚îÇ    1. Get pending messages (limit=30, SKIP LOCKED)       ‚îÇ
‚îÇ    2. Process in parallel (asyncio.gather)               ‚îÇ
‚îÇ    3. Send via aiogram Bot.send_message()                ‚îÇ
‚îÇ    4. Update status (SENT/FAILED)                        ‚îÇ
‚îÇ    5. Sleep 1s (rate limiting)                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   TELEGRAM API                            ‚îÇ
‚îÇ                 (30 messages/second max)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### TelegramQueueService

**–§–∞–π–ª**: `backend/app/services/telegram_queue_service.py`

```python
class TelegramQueueService:
    """–°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""

    @staticmethod
    async def add_notification(
        db: AsyncSession,
        telegram_id: int,
        message_text: str,
        notification_type: NotificationType,
        user_id: Optional[int] = None,
        parse_mode: str = "HTML",
        scheduled_at: Optional[datetime] = None,
        metadata: Optional[dict] = None
    ) -> TelegramNotification:
        """
        –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å

        Args:
            telegram_id: Telegram ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            message_text: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            notification_type: –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (enum)
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            parse_mode: HTML –∏–ª–∏ Markdown
            scheduled_at: –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å (None = –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
            metadata: –î–æ–ø. –¥–∞–Ω–Ω—ã–µ (JSON)

        Returns:
            TelegramNotification: –°–æ–∑–¥–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å
        """

    @staticmethod
    async def get_pending_messages(
        db: AsyncSession,
        limit: int = 30,
        include_scheduled: bool = True
    ) -> List[TelegramNotification]:
        """
        –ü–æ–ª—É—á–∏—Ç—å pending —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏

        Uses FOR UPDATE SKIP LOCKED –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
        """

    @staticmethod
    async def mark_processing(db: AsyncSession, notification_id: int):
        """–ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è"""

    @staticmethod
    async def mark_sent(db: AsyncSession, notification_id: int):
        """–ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"""

    @staticmethod
    async def mark_failed(
        db: AsyncSession,
        notification_id: int,
        error_message: str,
        permanent_failure: bool = False
    ):
        """
        –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ—à–∏–±–∫–∞

        Args:
            permanent_failure: True = PERMANENT_FAILURE (–±–µ–∑ retry)
                              False = FAILED (–±—É–¥–µ—Ç retry)
        """
```

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```python
class NotificationType(str, enum.Enum):
    LEADERBOARD_REWARD = "LEADERBOARD_REWARD"
    # –¢–µ–∫—Å—Ç: "üèÜ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–Ω—è–ª–∏ {position} –º–µ—Å—Ç–æ –≤ –Ω–µ–¥–µ–ª—å–Ω–æ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ"
    # Metadata: {"position": 3, "reward": 5000}

    MARKET_RESOLVED = "MARKET_RESOLVED"
    # –¢–µ–∫—Å—Ç: "üìä –†—ã–Ω–æ–∫ '{market_title}' –∑–∞–∫—Ä—ã—Ç. –†–µ–∑—É–ª—å—Ç–∞—Ç: {result}"
    # Metadata: {"market_id": 123, "result": "YES"}

    BET_WON = "BET_WON"
    # –¢–µ–∫—Å—Ç: "üéâ –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –≤—ã–∏–≥—Ä–∞–ª–∞! +{amount} PRED"
    # Metadata: {"bet_id": 456, "amount_won": 2500}

    BET_LOST = "BET_LOST"
    # –¢–µ–∫—Å—Ç: "üòî –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–ª–∞"
    # Metadata: {"bet_id": 789}

    MISSION_COMPLETED = "MISSION_COMPLETED"
    # –¢–µ–∫—Å—Ç: "‚úÖ –ú–∏—Å—Å–∏—è '{mission_title}' –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! +{reward} PRED"
    # Metadata: {"mission_id": 5, "reward": 1000}

    BROADCAST = "BROADCAST"
    # –¢–µ–∫—Å—Ç: –ª—é–±–æ–π (–æ—Ç –∞–¥–º–∏–Ω–∞)
    # Metadata: {"broadcast": true, "photo_url": "..."}

    SYSTEM = "SYSTEM"
    # –¢–µ–∫—Å—Ç: —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    # Metadata: –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### 1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ —Å—Ç–∞–≤–∫–∏

```python
# backend/app/api/endpoints/admin.py (market resolution)

for bet in winning_bets:
    # –ù–∞—á–∏—Å–ª–∏—Ç—å –≤—ã–∏–≥—Ä—ã—à
    user.pred_balance += bet.potential_win
    bet.status = BetStatus.WON

    # –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    await TelegramQueueService.add_notification(
        db=db,
        telegram_id=user.telegram_id,
        message_text=f"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –Ω–∞ —Ä—ã–Ω–∫–µ '{market.title}' –≤—ã–∏–≥—Ä–∞–ª–∞!\n\n"
                     f"üí∞ –í—ã–∏–≥—Ä—ã—à: +{bet.potential_win} PRED",
        notification_type=NotificationType.BET_WON,
        user_id=user.id,
        metadata={
            "bet_id": bet.id,
            "market_id": market.id,
            "amount_won": bet.potential_win
        }
    )
```

#### 2. Broadcast —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

```python
# backend/app/api/endpoints/admin.py (broadcast)

# Upload image to S3
photo_url = f"{settings.S3_PUBLIC_URL}/{settings.S3_BUCKET}/{filename}"

# Add to queue for each user
for telegram_id, user_id in recipients:
    await TelegramQueueService.add_notification(
        db=db,
        telegram_id=telegram_id,
        message_text=message,
        notification_type=NotificationType.BROADCAST,
        user_id=user_id,
        parse_mode=parse_mode,
        metadata={
            "broadcast": True,
            "photo_url": photo_url
        }
    )
```

#### 3. Weekly Leaderboard Rewards

```python
# backend/app/api/endpoints/scheduler.py (weekly job)

top_users = await get_top_leaderboard()

for position, user in enumerate(top_users[:10], start=1):
    reward = REWARDS[position]

    # –ù–∞—á–∏—Å–ª–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
    user.pred_balance += reward

    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    await TelegramQueueService.add_notification(
        db=db,
        telegram_id=user.telegram_id,
        message_text=f"üèÜ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–Ω—è–ª–∏ {position} –º–µ—Å—Ç–æ –≤ –Ω–µ–¥–µ–ª—å–Ω–æ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ!\n\n"
                     f"üí∞ –ù–∞–≥—Ä–∞–¥–∞: +{reward} PRED",
        notification_type=NotificationType.LEADERBOARD_REWARD,
        user_id=user.id,
        metadata={
            "position": position,
            "reward": reward,
            "period": "weekly"
        }
    )
```

### Rate Limiting

**Telegram API –ª–∏–º–∏—Ç—ã**:
- 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É —Ä–∞–∑–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- 20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É –æ–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- 1 —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–µ–∫—É–Ω–¥—É –≤ –æ–¥–∏–Ω —á–∞—Ç (–¥–ª—è –±–æ—Ç–æ–≤)

**–ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
# backend/telegram_worker.py

class TelegramWorker:
    def __init__(self, batch_size: int = 30):
        self.batch_size = min(batch_size, 30)  # Max 30 msg/sec

    async def _process_loop(self):
        while self.is_running:
            start_time = datetime.now()

            # Process batch (up to 30 messages)
            messages = await self._get_pending_messages(limit=self.batch_size)
            await asyncio.gather(*[self._send_message(msg) for msg in messages])

            # Calculate sleep to maintain 1 second per batch
            elapsed = (datetime.now() - start_time).total_seconds()
            sleep_time = max(0, 1.0 - elapsed)

            if len(messages) == 0:
                await asyncio.sleep(5)  # No messages - sleep longer
            else:
                await asyncio.sleep(sleep_time)
```

---

## Broadcast —Å–∏—Å—Ç–µ–º–∞

### –ü–æ–ª–Ω—ã–π workflow

#### 1. Frontend (Admin Panel)

**–§–∞–π–ª**: `admin/templates/broadcast.html`

```javascript
// Rich Text Editor
const editor = document.getElementById('message');

// Formatting buttons
function formatText(command) {
    const selection = window.getSelection().toString();
    const formatted = {
        'bold': `<b>${selection}</b>`,
        'italic': `<i>${selection}</i>`,
        'code': `<code>${selection}</code>`,
        'link': `<a href="URL">${selection}</a>`
    }[command];

    insertAtCursor(formatted);
}

// Emoji picker
function insertEmoji(emoji) {
    insertAtCursor(emoji);
}

// Image upload
async function handleImageUpload(event) {
    const file = event.target.files[0];
    uploadedImageFile = file;

    // Preview
    const reader = new FileReader();
    reader.onload = (e) => {
        preview.src = e.target.result;
    };
    reader.readAsDataURL(file);

    // Update character limit
    updateCharCounter(); // 4096 ‚Üí 1000
}

// Send broadcast
async function sendBroadcast() {
    const formData = new FormData();
    formData.append('message', message);
    formData.append('target', target);
    formData.append('parse_mode', parseMode);
    if (telegram_id) formData.append('telegram_id', telegram_id);
    if (uploadedImageFile) formData.append('image', uploadedImageFile);

    const response = await fetch('/admin/broadcast', {
        method: 'POST',
        body: formData
    });

    const result = await response.json();
    // Show success: "Broadcast queued for 150 users"
}
```

#### 2. Admin Proxy

**–§–∞–π–ª**: `admin/main.py`

```python
@app.route('/admin/broadcast', methods=['POST'])
@login_required
async def api_admin_broadcast():
    """Proxy broadcast request to backend API"""
    form = await request.form
    files = await request.files

    # Build FormData
    data = aiohttp.FormData()
    data.add_field('message', form.get('message'))
    data.add_field('target', form.get('target', 'all'))
    data.add_field('parse_mode', form.get('parse_mode', 'HTML'))

    if form.get('telegram_id'):
        data.add_field('telegram_id', form.get('telegram_id'))

    # Add image if uploaded
    if 'image' in files and files['image'].filename:
        image = files['image']
        image_bytes = image.read()
        data.add_field(
            'image',
            image_bytes,
            filename=image.filename,
            content_type=image.content_type
        )

    # Forward to backend
    async with aiohttp.ClientSession() as session:
        async with session.post(
            f"{app.config['API_URL']}/admin/broadcast",
            data=data
        ) as response:
            result = await response.json()
            return jsonify(result)
```

#### 3. Backend API

**–§–∞–π–ª**: `backend/app/api/endpoints/admin.py`

```python
@router.post("/broadcast")
async def broadcast_message(
    message: str = Form(...),
    target: str = Form("all"),
    parse_mode: str = Form("HTML"),
    telegram_id: Optional[int] = Form(None),
    image: Optional[UploadFile] = File(None),
    db: AsyncSession = Depends(get_db)
):
    """
    –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

    –ü–æ–¥–¥–µ—Ä–∂–∫–∞:
    - –¢–µ–∫—Å—Ç –¥–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤ (–±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
    - –¢–µ–∫—Å—Ç –¥–æ 1000 —Å–∏–º–≤–æ–ª–æ–≤ (—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º)
    - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ S3
    - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    """

    # Validate message length
    max_length = 1000 if image else 4096
    if len(message) > max_length:
        raise HTTPException(400, f"Message too long! Max {max_length} characters")

    # Upload image to S3 if provided
    photo_url = None
    if image:
        image_data = await image.read()
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f"broadcast/{timestamp}_{image.filename}"

        s3_client = boto3.client(
            's3',
            endpoint_url=settings.S3_ENDPOINT,
            aws_access_key_id=settings.S3_ACCESS_KEY,
            aws_secret_access_key=settings.S3_SECRET_KEY
        )

        s3_client.put_object(
            Bucket=settings.S3_BUCKET,
            Key=filename,
            Body=image_data,
            ContentType=image.content_type,
            ACL='public-read'
        )

        photo_url = f"{settings.S3_PUBLIC_URL}/{settings.S3_BUCKET}/{filename}"

    # Get recipients
    if target == "all":
        query = select(User.telegram_id, User.id).where(User.is_banned == False)
        result = await db.execute(query)
        recipients = [(row[0], row[1]) for row in result.all()]
    elif target == "specific" and telegram_id:
        query = select(User.telegram_id, User.id).where(User.telegram_id == telegram_id)
        result = await db.execute(query)
        row = result.first()
        recipients = [(row[0], row[1])] if row else []
    else:
        raise HTTPException(400, "Invalid target")

    # Add messages to queue
    queued_count = 0
    for tg_id, user_id in recipients:
        try:
            metadata = {"broadcast": True}
            if photo_url:
                metadata["photo_url"] = photo_url

            await TelegramQueueService.add_notification(
                db=db,
                telegram_id=tg_id,
                message_text=message,
                notification_type=NotificationType.BROADCAST,
                user_id=user_id,
                parse_mode=parse_mode,
                metadata=metadata
            )
            queued_count += 1

        except Exception as e:
            logger.error(f"[Broadcast] Failed to queue for {tg_id}: {e}")
            continue

    await db.commit()

    return {
        "total_recipients": len(recipients),
        "queued": queued_count,
        "message": f"Broadcast queued for {queued_count} users"
    }
```

#### 4. Queue Processing

**TelegramQueueService** –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î:

```sql
INSERT INTO telegram_notifications_queue (
    telegram_id,
    user_id,
    message_text,
    notification_type,
    parse_mode,
    notification_metadata,
    status
) VALUES (
    792818131,
    1,
    '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π üöÄ',
    'BROADCAST',
    'HTML',
    '{"broadcast": true, "photo_url": "https://thepred.store/..."}',
    'PENDING'
);
```

#### 5. Worker Processing

**–§–∞–π–ª**: `backend/telegram_worker.py`

```python
async def _send_message(self, notification: TelegramNotification):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""
    try:
        # Mark as processing
        await self._update_status(
            notification.id,
            NotificationStatus.PROCESSING
        )

        # Parse metadata
        metadata = json.loads(notification.notification_metadata or '{}')
        photo_url = metadata.get('photo_url')

        # Send message
        if photo_url:
            # Send photo with caption
            await self.bot.send_photo(
                chat_id=notification.telegram_id,
                photo=photo_url,
                caption=notification.message_text,
                parse_mode=notification.parse_mode
            )
        else:
            # Send text message
            await self.bot.send_message(
                chat_id=notification.telegram_id,
                text=notification.message_text,
                parse_mode=notification.parse_mode
            )

        # Mark as sent
        await self._update_status(
            notification.id,
            NotificationStatus.SENT
        )

        logger.info(f"‚úì Sent #{notification.id} to {notification.telegram_id}")

    except TelegramForbiddenError:
        # User blocked bot - permanent failure
        await self._update_status(
            notification.id,
            NotificationStatus.PERMANENT_FAILURE,
            error="User blocked bot"
        )

    except Exception as e:
        # Temporary error - will retry
        await self._update_status(
            notification.id,
            NotificationStatus.FAILED,
            error=str(e)
        )
```

#### 6. Delivery

–°–æ–æ–±—â–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:
- –° –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º ‚Üí `Bot.send_photo(caption=...)`
- –ë–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí `Bot.send_message(text=...)`
- Rate limiting: –º–∞–∫—Å–∏–º—É–º 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É

---

## –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

### ‚úÖ Backend API - 100%

1. **Database**:
   - ‚úÖ PostgreSQL + Alembic migrations
   - ‚úÖ 11 —Ç–∞–±–ª–∏—Ü (users, markets, bets, missions, user_missions, transactions, wallet_addresses, support_tickets, support_messages, telegram_notifications_queue, leaderboard_snapshots)
   - ‚úÖ 20 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ä—ã–Ω–∫–æ–≤ + seed data
   - ‚úÖ 19 –º–∏—Å—Å–∏–π

2. **API Endpoints**:
   - ‚úÖ Auth (register, token)
   - ‚úÖ Markets (list, detail, stats)
   - ‚úÖ Bets (create, my, detail)
   - ‚úÖ Users (profile, stats, public, ban/unban)
   - ‚úÖ Missions (list, claim) - 19 –º–∏—Å—Å–∏–π
   - ‚úÖ Leaderboard (4 —Ç–∏–ø–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
   - ‚úÖ Admin (stats, markets CRUD, users management, broadcast)
   - ‚úÖ Support (tickets, messages, admin replies)
   - ‚úÖ Scheduler (weekly rewards, cleanup)

3. **Features**:
   - ‚úÖ JWT Authentication
   - ‚úÖ Bet creation —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–æ–º odds (AMM)
   - ‚úÖ Market resolution (–≤—ã–ø–ª–∞—Ç—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏)
   - ‚úÖ Missions system —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏ (19 —Ç–∏–ø–æ–≤)
   - ‚úÖ Rank system (Bronze ‚Üí Grandmaster)
   - ‚úÖ Transaction history
   - ‚úÖ Ban system (ban/unban users)
   - ‚úÖ Support tickets (create, reply, close)
   - ‚úÖ Notification queue (TelegramQueueService)
   - ‚úÖ Broadcast system (text + images, rate limiting)
   - ‚úÖ S3/MinIO integration (image storage)
   - ‚úÖ Swagger documentation

### ‚úÖ Telegram Worker - 100%

1. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
   - ‚úÖ Queue processing (30 msg/sec rate limit)
   - ‚úÖ Error handling (temporary vs permanent failures)
   - ‚úÖ Retry logic (–¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫)
   - ‚úÖ Photo support (send_photo with caption)
   - ‚úÖ Metadata parsing (JSON)
   - ‚úÖ Status updates (PENDING ‚Üí PROCESSING ‚Üí SENT/FAILED)
   - ‚úÖ Logging
   - ‚úÖ Graceful shutdown

2. **Deployment**:
   - ‚úÖ Standalone process
   - ‚úÖ PM2 integration
   - ‚úÖ Production-ready

### ‚úÖ Telegram Bot - 100%

1. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
   - ‚úÖ /start - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   - ‚úÖ WebApp button (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App)
   - ‚úÖ Support tickets —á–µ—Ä–µ–∑ FSM
   - ‚úÖ Deep linking
   - ‚úÖ –ö–æ–º–∞–Ω–¥—ã: /help, /support, /balance, /stats

2. **Integration**:
   - ‚úÖ Backend API integration
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   - ‚úÖ WebApp URL generation

### ‚úÖ Mini App (Webapp) - 95%

1. **–°—Ç—Ä–∞–Ω–∏—Ü—ã**:
   - ‚úÖ Markets list —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - ‚úÖ Market detail —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å—Ç–∞–≤–æ–∫
   - ‚úÖ Profile —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å—Ç–∞–≤–æ–∫
   - ‚úÖ Missions —Å claim rewards
   - ‚úÖ Leaderboard —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
   - ‚úÖ Support tickets (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ UI)
   - ‚úÖ Responsive design (mobile-first)

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
   - ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API
   - ‚úÖ api_client.py —Å async requests
   - ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ Real-time updates

3. **UI/UX**:
   - ‚úÖ Tailwind CSS
   - ‚úÖ –ê–Ω–∏–º–∞—Ü–∏–∏
   - ‚úÖ –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
   - ‚úÖ Icons (Heroicons, Lucide)

**–ù–µ –≥–æ—Ç–æ–≤–æ**:
- ‚ö†Ô∏è TON Wallet UI –≥–æ—Ç–æ–≤, –Ω–æ –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å backend
- ‚ö†Ô∏è Support tickets UI (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

### ‚úÖ Admin Panel - 100%

1. **–†–∞–∑–¥–µ–ª—ã**:
   - ‚úÖ Dashboard (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, Chart.js –≥—Ä–∞—Ñ–∏–∫–∏)
   - ‚úÖ Markets (—Å–ø–∏—Å–æ–∫, create, edit, resolve, delete)
   - ‚úÖ Users (—Å–ø–∏—Å–æ–∫, edit balance, ban/unban, view activity)
   - ‚úÖ Broadcast (rich editor, emoji picker, image upload, queue) - NEW
   - ‚úÖ Support (tickets list, reply, close)

2. **Broadcast Features**:
   - ‚úÖ Rich text editor —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - ‚úÖ 32 emoji picker
   - ‚úÖ Image upload —Å preview
   - ‚úÖ Character counter (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç)
   - ‚úÖ Target selection (all/specific user)
   - ‚úÖ Parse mode (HTML/Markdown)
   - ‚úÖ Queue integration
   - ‚úÖ Success feedback

3. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
   - ‚úÖ Market resolution (YES/NO/CANCELLED)
   - ‚úÖ Promote/Unpromote markets
   - ‚úÖ Edit user balances
   - ‚úÖ Ban/Unban users —Å –ø—Ä–∏—á–∏–Ω–æ–π
   - ‚úÖ View user bet history
   - ‚úÖ Platform statistics
   - ‚úÖ Support ticket management

### ‚úÖ Landing Page - 100%

1. **–°–µ–∫—Ü–∏–∏**:
   - ‚úÖ Hero —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ä—ã–Ω–∫–æ–≤
   - ‚úÖ Philosophy
   - ‚úÖ How It Works
   - ‚úÖ Features
   - ‚úÖ Gamification
   - ‚úÖ AI Assistant (Coming Soon)
   - ‚úÖ Social Proof
   - ‚úÖ Footer

2. **–î–∏–∑–∞–π–Ω**:
   - ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π (mobile, tablet, desktop)
   - ‚úÖ –ê–Ω–∏–º–∞—Ü–∏–∏ (CSS, JS)
   - ‚úÖ Gradients, glass effects
   - ‚úÖ SEO meta tags

---

## –ß—Ç–æ –Ω–µ –≥–æ—Ç–æ–≤–æ

### ‚ùå TON Wallet Integration - 0% (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å**:

#### Frontend (Mini App):
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å TON Connect SDK
2. UI –¥–ª—è Connect/Disconnect wallet
3. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ TON –∞–¥—Ä–µ—Å–∞ –∏ –±–∞–ª–∞–Ω—Å–∞
4. UI –¥–ª—è Deposit (TON ‚Üí PRED)
5. UI –¥–ª—è Withdraw (PRED ‚Üí TON)

#### Backend API:
1. `POST /wallet/connect` - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å TON –∞–¥—Ä–µ—Å
2. `POST /wallet/deposit/initiate` - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å deposit –∞–¥—Ä–µ—Å
3. `POST /wallet/deposit/confirm` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ blockchain
4. `POST /wallet/withdraw` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å TON
5. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è TON ‚Üî PRED (rate: 1 TON = 1000 PRED)
6. TON blockchain integration (TON API –∏–ª–∏ SDK)
7. –û–±—Ä–∞–±–æ—Ç–∫–∞ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–†–µ—Å—É—Ä—Å—ã**:
- TON Connect SDK: https://github.com/ton-connect/sdk
- TON API: https://tonapi.io/
- TON Docs: https://docs.ton.org/

**–û—Ü–µ–Ω–∫–∞**: 12-16 —á–∞—Å–æ–≤

### ‚ö†Ô∏è Support Tickets UI - 50% (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

**–ß—Ç–æ –≥–æ—Ç–æ–≤–æ**:
- ‚úÖ Backend API (create, list, messages, reply)
- ‚úÖ Database models
- ‚úÖ Admin panel UI

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è**:
- ‚ùå Mini App UI –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå Telegram bot integration (inline —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤)
- ‚ùå Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

**–û—Ü–µ–Ω–∫–∞**: 4-6 —á–∞—Å–æ–≤

### ‚ùå Testing - 0% (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)

**–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**:
1. –í—Å–µ webapp —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–æ–∫
3. Missions claim
4. Market resolution
5. Admin panel —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
6. Bot WebApp integration
7. API endpoints —á–µ—Ä–µ–∑ Swagger
8. Broadcast system (text + images)
9. Support tickets workflow

**–û—Ü–µ–Ω–∫–∞**: 6-8 —á–∞—Å–æ–≤

### ‚ö†Ô∏è Production Monitoring - 20% (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4)

**–ß—Ç–æ –≥–æ—Ç–æ–≤–æ**:
- ‚úÖ PM2 process manager
- ‚úÖ Nginx reverse proxy
- ‚úÖ SSL certificates

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è**:
- ‚ùå Sentry integration (error tracking)
- ‚ùå Grafana + Prometheus (metrics)
- ‚ùå Uptime monitoring (UptimeRobot)
- ‚ùå Database backups automation
- ‚ùå Alerts (Telegram bot)

**–û—Ü–µ–Ω–∫–∞**: 4-6 —á–∞—Å–æ–≤

---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker + Docker Compose
- Python 3.11+
- PostgreSQL 15+ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –≤ Docker)
- Redis 7+ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –≤ Docker)
- MinIO (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –≤ Docker)

### 1. –ß–µ—Ä–µ–∑ Docker Compose (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Development)

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
cd ThePred

# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make up
# –∏–ª–∏
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
make logs
# –∏–ª–∏
docker-compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–æ–≤
make health
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ URL**:
- Backend API: http://localhost:8000/docs
- Mini App: http://localhost:8001
- Admin Panel: http://localhost:8002
- Landing Page: http://localhost:8003
- PostgreSQL: localhost:5432
- Redis: localhost:6379
- MinIO: localhost:9000

### 2. Production Setup (PM2)

**–ù–∞ production —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PM2 –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏**

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
cd /home/ThePredMain

# Backend
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Bot
cd ../bot
pip install -r requirements.txt

# Webapp
cd ../webapp
pip install -r requirements.txt

# Admin
cd ../admin
pip install -r requirements.txt

# Landing
cd ../landing
pip install -r requirements.txt
```

#### PM2 Configuration:

```javascript
// ecosystem.config.js
module.exports = {
  apps: [
    {
      name: 'backend',
      script: 'venv/bin/uvicorn',
      args: 'app.main:app --host 0.0.0.0 --port 8000',
      cwd: '/home/ThePredMain/backend',
      env: {
        POSTGRES_HOST: 'localhost',
        DATABASE_URL: 'postgresql://...',
        ...
      }
    },
    {
      name: 'telegram-worker',
      script: 'venv/bin/python',
      args: 'telegram_worker.py',
      cwd: '/home/ThePredMain/backend',
      env: {
        BOT_TOKEN: '...',
        POSTGRES_HOST: 'localhost',
        ...
      }
    },
    {
      name: 'bot',
      script: 'python',
      args: 'main.py',
      cwd: '/home/ThePredMain/bot',
      env: {
        BOT_TOKEN: '...',
        API_URL: 'http://localhost:8000',
        ...
      }
    },
    {
      name: 'webapp',
      script: 'python',
      args: 'main.py',
      cwd: '/home/ThePredMain/webapp'
    },
    {
      name: 'admin',
      script: 'python',
      args: 'main.py',
      cwd: '/home/ThePredMain/admin'
    },
    {
      name: 'landing',
      script: 'python',
      args: 'main.py',
      cwd: '/home/ThePredMain/landing'
    }
  ]
};
```

#### –ö–æ–º–∞–Ω–¥—ã PM2:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
pm2 start ecosystem.config.js

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status

# –õ–æ–≥–∏
pm2 logs
pm2 logs backend
pm2 logs telegram-worker

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart all
pm2 restart backend
pm2 restart telegram-worker

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 stop all
pm2 delete all
```

### 3. Database Migrations

```bash
# Development
cd backend
POSTGRES_HOST=localhost alembic upgrade head

# Production (—á–µ—Ä–µ–∑ Docker)
docker exec -it thepredmain-backend-1 alembic upgrade head

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision -m "Description"

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
alembic current

# –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
alembic history
```

### 4. Seed Data

```bash
# Development
cd backend
POSTGRES_HOST=localhost python3 seed_data.py

# Production
docker exec -it thepredmain-backend-1 python seed_data.py
```

---

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Environment Variables

**–ì–ª–∞–≤–Ω—ã–π .env —Ñ–∞–π–ª** (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞):

```env
# ============ Database ============
POSTGRES_DB=thepred
POSTGRES_USER=thepred
POSTGRES_PASSWORD=SUPER_STRONG_PASSWORD_CHANGE_ME_123!@#
POSTGRES_HOST=localhost  # –∏–ª–∏ postgres –¥–ª—è Docker

# ============ JWT ============
JWT_SECRET=YOUR_SUPER_SECRET_JWT_KEY_MINIMUM_32_CHARS_RANDOM
JWT_ALGORITHM=HS256
JWT_EXPIRE_HOURS=24

# ============ Application ============
DEBUG=false
INITIAL_PRED_BALANCE=10000
REFERRAL_BONUS_PRED=1000

# ============ Telegram Bot ============
BOT_TOKEN=8067436515:AAGHg6_ojgsnBmREI1U9Sr_iibgXYGInml0
BOT_USERNAME=The_Pred_Bot

# ============ WebApp ============
WEBAPP_URL=https://thepred.tech
WEBAPP_SECRET_KEY=WEBAPP_SECRET_KEY_RANDOM_STRING_32_CHARS
DEV_MODE=false

# ============ Admin ============
ADMIN_PASSWORD=STRONG_ADMIN_PASSWORD_CHANGE_ME
ADMIN_SECRET_KEY=ADMIN_SECRET_KEY_RANDOM_32_CHARS

# ============ MinIO S3 Storage ============
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=Ivanbunin110818
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=admin
S3_SECRET_KEY=Ivanbunin110818
S3_BUCKET=thepred-events
S3_PUBLIC_URL=https://thepred.store

# ============ API URL ============
API_URL=http://localhost:8000

# ============ Redis ============
REDIS_HOST=localhost
REDIS_PORT=6379
```

### Makefile –∫–æ–º–∞–Ω–¥—ã

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help          # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make up            # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make down          # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make restart       # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make logs          # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make ps            # –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

# –õ–æ–≥–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make logs-backend
make logs-bot
make logs-webapp
make logs-admin
make logs-landing

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make backend-restart
make bot-restart
make webapp-restart
make admin-restart
make landing-restart

# Shell –¥–æ—Å—Ç—É–ø
make backend-shell   # –í–æ–π—Ç–∏ –≤ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
make bot-shell       # –í–æ–π—Ç–∏ –≤ bot –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
make db-shell        # –û—Ç–∫—Ä—ã—Ç—å PostgreSQL shell
make redis-shell     # –û—Ç–∫—Ä—ã—Ç—å Redis CLI

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
make db-migrate      # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make db-reset        # –°–±—Ä–æ—Å–∏—Ç—å –ë–î (—É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)
make backup          # –°–æ–∑–¥–∞—Ç—å backup –ë–î
make restore FILE=backup.sql  # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup

# Production
make prod-build      # –°–æ–±—Ä–∞—Ç—å –¥–ª—è production
make prod-up         # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ production —Ä–µ–∂–∏–º–µ
make prod-rebuild-app # –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å app —Å–µ—Ä–≤–∏—Å—ã
make prod-status     # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å production
make prod-logs       # Production –ª–æ–≥–∏
```

### Git Workflow

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
git status

# –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .

# –ö–æ–º–º–∏—Ç
git commit -m "Description"

# Push
git push origin main

# Pull –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main
```

### Debugging

**Backend (FastAPI)**:
```bash
# –í–∫–ª—é—á–∏—Ç—å debug —Ä–µ–∂–∏–º
DEBUG=true uvicorn app.main:app --reload

# Swagger UI
http://localhost:8000/docs

# –õ–æ–≥–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
# –í config.py —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å echo=True –≤ create_async_engine
```

**Telegram Worker**:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
BOT_TOKEN="..." python telegram_worker.py

# PM2 –ª–æ–≥–∏
pm2 logs telegram-worker --lines 100
```

**Database queries**:
```bash
# PostgreSQL shell
psql -U thepred -d thepred

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å
SELECT id, telegram_id, status, notification_type, created_at
FROM telegram_notifications_queue
ORDER BY created_at DESC
LIMIT 10;

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å pending —Å–æ–æ–±—â–µ–Ω–∏—è
SELECT COUNT(*)
FROM telegram_notifications_queue
WHERE status = 'PENDING';
```

---

## Production Deployment

### 1. Server Requirements

- Ubuntu 22.04 LTS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- 2 CPU cores minimum
- 4 GB RAM minimum
- 20 GB SSD storage
- Domain —Å SSL

### 2. Initial Setup

```bash
# Update system
sudo apt update
sudo apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# Install Docker Compose
sudo apt install docker-compose -y

# Install Node.js + PM2
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs
sudo npm install -g pm2

# Install PostgreSQL client tools
sudo apt install postgresql-client -y

# Clone project
git clone https://github.com/Mobiss11/ThePredMain.git
cd ThePredMain
```

### 3. Environment Configuration

```bash
# Create production .env
cp .env.example .env
nano .env

# Set production values:
# - Strong passwords
# - Production URLs
# - Real BOT_TOKEN
# - Production S3_PUBLIC_URL
# - DEBUG=false
```

### 4. Database Setup

```bash
# Start PostgreSQL via Docker
docker-compose up -d postgres

# Wait for startup
sleep 10

# Run migrations
cd backend
source venv/bin/activate
POSTGRES_HOST=localhost alembic upgrade head

# Seed initial data (optional)
POSTGRES_HOST=localhost python seed_data.py
```

### 5. Nginx Configuration

```bash
sudo apt install nginx -y

# Create nginx config
sudo nano /etc/nginx/sites-available/thepred
```

**Nginx config**:
```nginx
# Main webapp
server {
    listen 80;
    server_name thepred.tech www.thepred.tech;

    location / {
        proxy_pass http://localhost:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/ {
        proxy_pass http://localhost:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# Admin panel (subdomain or path)
server {
    listen 80;
    server_name admin.thepred.tech;

    location / {
        proxy_pass http://localhost:8002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# Landing page
server {
    listen 80;
    server_name landing.thepred.tech;

    location / {
        proxy_pass http://localhost:8003;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# MinIO S3 (for images)
server {
    listen 80;
    server_name thepred.store;

    location / {
        proxy_pass http://localhost:9000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

```bash
# Enable site
sudo ln -s /etc/nginx/sites-available/thepred /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 6. SSL Certificates

```bash
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d thepred.tech -d www.thepred.tech -d admin.thepred.tech -d thepred.store
```

### 7. Start Services

```bash
# Start via PM2
pm2 start ecosystem.config.js

# Check status
pm2 status

# Save PM2 config
pm2 save

# Enable PM2 on startup
pm2 startup
# Follow instructions to enable startup
```

### 8. Monitoring

```bash
# PM2 monitoring
pm2 monit

# Logs
pm2 logs

# Restart all
pm2 restart all

# Stop all
pm2 stop all

# Delete all
pm2 delete all
```

### 9. Database Backups

```bash
# Create backup directory
mkdir -p /home/ThePredMain/backups

# Backup script
cat > /home/ThePredMain/backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
docker exec -it thepredmain-postgres-1 pg_dump -U thepred thepred > /home/ThePredMain/backups/backup_$DATE.sql
# Keep only last 7 days
find /home/ThePredMain/backups -name "backup_*.sql" -mtime +7 -delete
EOF

chmod +x /home/ThePredMain/backup.sh

# Add to crontab (daily at 2 AM)
crontab -e
# Add line:
0 2 * * * /home/ThePredMain/backup.sh
```

### 10. Updates

```bash
# Pull latest changes
cd /home/ThePredMain
git pull origin main

# Run migrations
cd backend
source venv/bin/activate
alembic upgrade head

# Restart services
pm2 restart all

# Check logs
pm2 logs --lines 50
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**ThePred** - —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ prediction markets —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ Telegram —ç–∫–æ—Å–∏—Å—Ç–µ–º—É.

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: 97% Complete

**–ì–æ—Ç–æ–≤–æ**:
- ‚úÖ Backend API (FastAPI) - 100%
- ‚úÖ Telegram Bot (aiogram) - 100%
- ‚úÖ Telegram Worker (queue processor) - 100%
- ‚úÖ Mini App (Quart) - 95%
- ‚úÖ Admin Panel (Quart) - 100%
- ‚úÖ Landing Page - 100%
- ‚úÖ Broadcast System - 100%
- ‚úÖ Support Tickets (backend) - 100%
- ‚úÖ Database Schema - 100%
- ‚úÖ Migrations - 100%

**–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ**:
- ‚ö†Ô∏è TON Wallet Integration - 0%
- ‚ö†Ô∏è Support Tickets UI (user) - 50%
- ‚ö†Ô∏è Testing - 0%
- ‚ö†Ô∏è Production Monitoring - 20%

### –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **Telegram Bot**: @The_Pred_Bot
- **Website**: https://thepred.tech
- **Admin Panel**: https://admin.thepred.tech (internal)
- **GitHub**: https://github.com/Mobiss11/ThePredMain

### –ö–æ–º–∞–Ω–¥—ã

```bash
make help    # –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make up      # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
make logs    # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make health  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 8 –Ω–æ—è–±—Ä—è 2025
**–ê–≤—Ç–æ—Ä**: ThePred Team
**–í–µ—Ä—Å–∏—è**: 1.2
